<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<title>Tic-Tac-Stick Quote Engine</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
	<meta name="description" content="Professional quoting tool for 925 Pressure Glass - Window & Pressure Cleaning" />
	<meta name="theme-color" content="#6c63ff" />

	<!-- Content Security Policy -->
	<meta http-equiv="Content-Security-Policy" content="
		default-src 'self';
		script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com;
		style-src 'self' 'unsafe-inline';
		img-src 'self' data: blob:;
		font-src 'self';
		connect-src 'self' https://*.workers.dev https://services.leadconnectorhq.com https://rest.gohighlevel.com;
		object-src 'none';
		base-uri 'self';
		form-action 'self';
		frame-ancestors 'none';
		upgrade-insecure-requests;
	">

	<!-- PWA Manifest -->
	<link rel="manifest" href="manifest.json" />

	<!-- Favicon -->
	<link rel="icon" type="image/png" sizes="32x32" href="favicon.png" />
	<link rel="icon" type="image/svg+xml" href="icon.svg" />

	<!-- Apple Touch Icon -->
	<link rel="apple-touch-icon" href="icon-192.png" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
	<meta name="apple-mobile-web-app-title" content="Quote Engine" />

	<!-- CSS -->
	<!-- Design System - Load FIRST to provide CSS variables and base styles -->
	<link rel="stylesheet" href="css/design-system.css" />
	<link rel="stylesheet" href="app.css" />
	<link rel="stylesheet" href="toast.css" />
	<link rel="stylesheet" href="loading.css" />
	<link rel="stylesheet" href="photo-modal.css" />
	<link rel="stylesheet" href="client-database.css" />
	<link rel="stylesheet" href="quote-workflow.css" />
	<link rel="stylesheet" href="import-export.css" />
	<link rel="stylesheet" href="invoice.css" />
	<link rel="stylesheet" href="validation.css" />
	<link rel="stylesheet" href="shortcuts.css" />
	<link rel="stylesheet" href="theme-light.css" />
	<link rel="stylesheet" href="theme-customizer.css" />
	<link rel="stylesheet" href="analytics.css" />
	<link rel="stylesheet" href="css/analytics-dashboard.css" />
	<link rel="stylesheet" href="photos.css" />
	<link rel="stylesheet" href="css/tasks.css" />
	<link rel="stylesheet" href="mobile.css" />
	<link rel="stylesheet" href="quote-pdf.css" />
	<link rel="stylesheet" href="css/test-runner.css" />
	<link rel="stylesheet" href="print.css" media="print" />
	<link rel="stylesheet" href="invoice-print.css" media="print" />
	<link rel="stylesheet" href="photo-print-layout.css" media="print" />
	<link rel="stylesheet" href="letterhead.css" media="print" />
</head>

<body class="accordion-mode">
	<div class="app">
		<!-- HEADER -->
		<header class="hdr">
			<div class="hdr-row">
				<div class="hdr-ic">üßΩ</div>
				<div class="hdr-info">
					<div class="hdr-title">Tic-Tac-Stick Quote Engine</div>
					<div class="hdr-subtitle">925 Pressure Glass ¬∑ Window & Pressure Cleaning</div>
				</div>
			</div>
			<div class="hdr-row hdr-row-meta">
				<div class="hdr-meta">
					<label class="hdr-meta-field">
						<span>Quote Title</span>
						<input id="quoteTitleInput" type="text" placeholder="e.g. Zoe Williams ‚Äì Balcony Glass & External Doors" aria-label="Quote title" />
					</label>
					<label class="hdr-meta-field">
						<span>Client Name</span>
						<input id="clientNameInput" type="text" placeholder="Client name" aria-label="Client name" />
					</label>
					<label class="hdr-meta-field">
						<span>Client Location / Area</span>
						<input id="clientLocationInput" type="text" placeholder="Suburb / area" aria-label="Client location or area" />
					</label>
					<label class="hdr-meta-field">
						<span>Job Type</span>
						<select id="jobTypeInput" aria-label="Select job type">
							<option value="">Select...</option>
							<option value="residential">Residential Windows</option>
							<option value="commercial">Commercial Windows</option>
							<option value="pressure">Pressure Cleaning</option>
							<option value="mixed">Mixed Windows & Pressure</option>
						</select>
					</label>
				</div>
				<div class="hdr-actions">
					<button id="toggleModeBtn" type="button" class="btn btn-secondary" aria-label="Switch to wizard mode">
						Switch to Wizard Mode
					</button>
					<button id="clearAllBtn" type="button" class="btn btn-tertiary" aria-label="Clear all quote data">
						Clear All
					</button>
					<button id="keyboardShortcutsBtn" type="button" class="btn btn-tertiary" title="Keyboard Shortcuts (Press ?)" aria-label="View keyboard shortcuts">
						‚å®Ô∏è Help
					</button>
					<button id="webhookSettingsBtn" type="button" class="btn btn-tertiary" title="Webhook & Sync Settings" aria-label="Open webhook settings" onclick="openWebhookSettings()">
						üîÑ Sync
					</button>
				<button id="testRunnerBtn" type="button" class="btn btn-tertiary" title="Test & QA Suite" aria-label="Open test runner" onclick="openTestRunner()">
					üß™ Tests
				</button>
				</div>
			</div>
		</header>

		<!-- MAIN -->
		<main class="main">
			<!-- LEFT COLUMN -->
			<section class="col col-left">
				<!-- CONFIG PANEL -->
				<section class="section" id="configPanel">
					<header class="sec-h">
						<h2 class="sec-title">Job Settings</h2>
						<button class="card-toggle" type="button" data-target="configBody">‚ñæ</button>
					</header>
					<div class="sec-b" id="configBody">
						<div class="config-grid">
							<!-- BASE FEE -->
							<label class="field">
								<span class="field-label">Base Callout Fee ($)</span>
								<input id="baseFeeInput" type="number" min="0" step="1" value="120" inputmode="decimal" />
								<small class="field-help">
									Covers travel & setup; always charged once per job.
								</small>
							</label>

							<!-- HOURLY RATE -->
							<label class="field">
								<span class="field-label">Hourly Rate ($/hr)</span>
								<input id="hourlyRateInput" type="number" min="0" step="1" value="95" inputmode="decimal" />
								<small class="field-help">
									Used to convert time to labour cost.
								</small>
							</label>

							<!-- MINIMUM JOB -->
							<label class="field">
								<span class="field-label">Minimum Job Charge ($)</span>
								<input id="minimumJobInput" type="number" min="0" step="1" value="180" inputmode="decimal" />
								<small class="field-help">
									Final total will never drop below this amount.
								</small>
							</label>

							<!-- HIGH REACH MODIFIER -->
							<label class="field">
								<span class="field-label">High Reach Modifier (%)</span>
								<input id="highReachModifierInput" type="number" min="0" step="5" value="60" inputmode="decimal" />
								<small class="field-help">
									Added as a % of exterior pane cost for high reach work.
								</small>
							</label>

							<!-- INSIDE / OUTSIDE MULTIPLIERS -->
							<label class="field">
								<span class="field-label">Inside Time Multiplier</span>
								<input id="insideMultiplierInput" type="number" min="0.5" step="0.1" value="1.0" inputmode="decimal" />
								<small class="field-help">Fine-tune inside pane timings.</small>
							</label>

							<label class="field">
								<span class="field-label">Outside Time Multiplier</span>
								<input id="outsideMultiplierInput" type="number" min="0.5" step="0.1" value="1.0" inputmode="decimal" />
								<small class="field-help">Fine-tune outside pane timings.</small>
							</label>

							<!-- PRESSURE CLEAN SETTINGS -->
							<label class="field">
								<span class="field-label">Pressure Clean Base Rate ($/hr)</span>
								<input id="pressureHourlyRateInput" type="number" min="0" step="1" value="120" inputmode="decimal" />
								<small class="field-help">
									Used for all surface time calculations.
								</small>
							</label>

							<label class="field">
								<span class="field-label">Travel / Setup Buffer (mins)</span>
								<input id="setupBufferMinutesInput" type="number" min="0" step="5" value="15" inputmode="numeric" />
								<small class="field-help">
									Added once per job to cover hose run, machine setup, etc.
								</small>
							</label>
						</div>

						<!-- AUTOSAVE & PRESETS -->
						<div class="config-footer">
							<label class="toggle">
								<input id="autosaveToggle" type="checkbox" checked />
								<span>Autosave this quote in browser</span>
							</label>
							<div class="config-footer-row">
								<button id="savePresetBtn" type="button" class="btn btn-sm btn-primary" aria-label="Save current settings as preset">
									Save as Preset
								</button>
								<select id="presetSelect" class="preset-select" aria-label="Load saved preset">
									<option value="">Load Preset...</option>
								</select>
							</div>
							<div class="config-footer-row">
								<button id="saveTemplateBtn" type="button" class="btn btn-sm btn-secondary" aria-label="Save current quote as template">
									Save as Template
								</button>
								<select id="templateSelect" class="preset-select" aria-label="Choose quote template">
									<option value="">Choose Template...</option>
								</select>
							</div>
						</div>
					</div>
				</section>

				<!-- WINDOWS PANEL -->
				<section class="section" id="windowsPanel">
					<header class="sec-h">
						<h2 class="sec-title">Windows</h2>
						<div class="card-hdr-actions">
							<button id="addWindowLineBtn" type="button" class="btn btn-sm btn-primary" aria-label="Add window line item manually">
								+ Add Manual Line
							</button>
							<button id="openWindowWizardBtn" type="button" class="btn btn-secondary btn-sm" aria-label="Open window wizard for guided entry">
								Open Window Wizard
							</button>
							<button class="card-toggle" type="button" data-target="windowsBody" aria-label="Toggle windows section" aria-expanded="true">‚ñæ</button>
						</div>
					</header>
					<div class="sec-b" id="windowsBody">
						<div class="lines-list" id="windowLinesContainer"></div>
					</div>
				</section>

				<!-- PRESSURE PANEL -->
				<section class="section" id="pressurePanel">
					<header class="sec-h">
						<h2 class="sec-title">Pressure Cleaning</h2>
						<div class="card-hdr-actions">
							<button id="addPressureLineBtn" type="button" class="btn btn-sm btn-primary" aria-label="Add pressure cleaning line item manually">
								+ Add Manual Line
							</button>
							<button id="openPressureWizardBtn" type="button" class="btn btn-secondary btn-sm" aria-label="Open pressure wizard for guided entry">
								Open Pressure Wizard
							</button>
							<button class="card-toggle" type="button" data-target="pressureBody" aria-label="Toggle pressure cleaning section" aria-expanded="true">‚ñæ</button>
						</div>
					</header>
					<div class="sec-b" id="pressureBody">
						<div class="lines-list" id="pressureLinesContainer"></div>
					</div>
				</section>
			</section>

			<!-- RIGHT COLUMN -->
			<section class="col col-right">
				<!-- SUMMARY PANEL -->
				<section class="section card-summary" id="summaryPanel">
					<header class="sec-h">
						<h2 class="sec-title">Quote Summary</h2>
						<button class="card-toggle" type="button" data-target="summaryBody">‚ñæ</button>
					</header>
					<div class="sec-b" id="summaryBody">
						<div class="summary-main">
							<div class="summary-block">
								<div class="summary-label">Subtotal (excl. GST)</div>
								<div class="summary-value" id="subtotalDisplay">$0</div>
							</div>
							<div class="summary-block">
								<div class="summary-label">High Reach Adjustments</div>
								<div class="summary-value" id="highReachDisplay">$0</div>
							</div>
							<div class="summary-block">
								<div class="summary-label">GST (10%)</div>
								<div class="summary-value" id="gstDisplay">$0</div>
							</div>
							<div class="summary-block summary-block-total">
								<div class="summary-label">Final Total (incl. GST, inc. min job)</div>
								<div class="summary-value" id="totalIncGstDisplay">$0</div>
							</div>
						</div>

						<div class="summary-sub">
							<div class="summary-sub-col">
								<h3>Time Estimate</h3>
								<p id="timeEstimateDisplay">0.00 hrs total</p>
								<ul class="summary-list">
									<li><span>Windows Time:</span> <span id="windowsTimeDisplay">0.00 hrs</span></li>
									<li><span>Pressure Time:</span> <span id="pressureTimeDisplay">0.00 hrs</span></li>
									<li><span>Setup / Travel:</span> <span id="setupTimeDisplay">0.00 hrs</span></li>
									<li><span>High Reach Extra:</span> <span id="highReachTimeDisplay">0.00 hrs</span></li>
								</ul>
							</div>
							<div class="summary-sub-col">
								<h3>Cost Breakdown</h3>
								<ul class="summary-list">
									<li><span>Base Callout:</span> <span id="baseFeeDisplay">$0</span></li>
									<li><span>Windows Labour:</span> <span id="windowsCostDisplay">$0</span></li>
									<li><span>Pressure Labour:</span> <span id="pressureCostDisplay">$0</span></li>
									<li><span>High Reach Premium:</span> <span id="highReachCostDisplay">$0</span></li>
									<li><span>Other Adjustments:</span> <span id="otherAdjustmentsDisplay">$0</span></li>
								</ul>
							</div>
						</div>

						<div class="summary-chart-wrap">
							<h3>Time Distribution</h3>
							<canvas id="timeChart" width="400" height="200"></canvas>
						</div>
					</div>
				</section>

				<!-- PHOTOS PANEL -->
				<section class="section" id="photosSection">
					<header class="sec-h">
						<h2 class="sec-title">üì∑ Photos</h2>
						<button class="card-toggle" type="button" data-target="photosBody">‚ñæ</button>
					</header>
					<div class="sec-b" id="photosBody">
						<div id="photoGallery">
							<p class="photo-gallery-empty">No photos attached</p>
						</div>
					</div>
				</section>

				<!-- NOTES PANEL -->
				<section class="section" id="notesPanel">
					<header class="sec-h">
						<h2 class="sec-title">Notes & Extras</h2>
						<button class="card-toggle" type="button" data-target="notesBody">‚ñæ</button>
					</header>
					<div class="sec-b" id="notesBody">
						<label class="field">
							<span class="field-label">Internal Notes (for you)</span>
							<textarea id="internalNotesInput" rows="4" placeholder="E.g. ladder access required, tight balcony, recurring customer"></textarea>
						</label>

						<label class="field">
							<span class="field-label">Client-Facing Notes</span>
							<textarea id="clientNotesInput" rows="4" placeholder="E.g. Quote excludes flyscreen removal, valid for 14 days."></textarea>
						</label>

						<div class="notes-footer">
							<button id="generatePdfBtn" type="button" class="btn">
								Export Quote Breakdown (PDF)
							</button>
							<button id="copySummaryBtn" type="button" class="btn btn-secondary">
								Copy Summary for SMS / Email
							</button>
						</div>
					</div>
				</section>

				<!-- ANALYTICS PANEL -->
				<section class="section" id="analyticsPanel">
					<header class="sec-h">
						<h2 class="sec-title">üìä Quote History & Analytics</h2>
						<button class="card-toggle" type="button" data-target="analyticsBody">‚ñæ</button>
					</header>
					<div class="sec-b" id="analyticsBody">
						<!-- Analytics Dashboard Controls -->
						<div class="config-footer-row" style="margin-bottom: 15px;">
							<select class="form-select" id="analytics-date-range-selector" aria-label="Select date range">
								<option value="last_7_days">Last 7 Days</option>
								<option value="last_30_days" selected>Last 30 Days</option>
								<option value="last_90_days">Last 90 Days</option>
								<option value="this_month">This Month</option>
								<option value="last_month">Last Month</option>
								<option value="this_year">This Year</option>
							</select>
							<button type="button" class="btn btn-sm btn-secondary" onclick="exportAnalyticsDashboard()" aria-label="Export analytics report">
								Export Report
							</button>
						</div>

						<!-- KPI Cards -->
						<div class="kpi-grid">
							<!-- Revenue Card -->
							<div class="card kpi-card">
								<div class="card-body">
									<div class="kpi-header">
										<span class="kpi-label">Total Revenue</span>
										<span class="kpi-trend kpi-trend-flat" id="revenue-trend">-</span>
									</div>
									<div class="kpi-value" id="kpi-revenue">$0.00</div>
									<div class="kpi-footer">
										<div class="kpi-progress">
											<div class="kpi-progress-bar" id="revenue-progress" style="width: 0%"></div>
										</div>
										<span class="kpi-target" id="revenue-target">Target: $20,000</span>
									</div>
								</div>
							</div>

							<!-- Quotes Card -->
							<div class="card kpi-card">
								<div class="card-body">
									<div class="kpi-header">
										<span class="kpi-label">Quotes Generated</span>
										<span class="kpi-trend kpi-trend-flat" id="quotes-trend">-</span>
									</div>
									<div class="kpi-value" id="kpi-quotes">0</div>
									<div class="kpi-footer">
										<div class="kpi-progress">
											<div class="kpi-progress-bar" id="quotes-progress" style="width: 0%"></div>
										</div>
										<span class="kpi-target" id="quotes-target">Target: 30</span>
									</div>
								</div>
							</div>

							<!-- Conversion Rate Card -->
							<div class="card kpi-card">
								<div class="card-body">
									<div class="kpi-header">
										<span class="kpi-label">Conversion Rate</span>
										<span class="kpi-trend kpi-trend-flat" id="conversion-trend">-</span>
									</div>
									<div class="kpi-value" id="kpi-conversion">0%</div>
									<div class="kpi-footer">
										<div class="kpi-progress">
											<div class="kpi-progress-bar" id="conversion-progress" style="width: 0%"></div>
										</div>
										<span class="kpi-target" id="conversion-target">Target: 35%</span>
									</div>
								</div>
							</div>

							<!-- Avg Quote Value Card -->
							<div class="card kpi-card">
								<div class="card-body">
									<div class="kpi-header">
										<span class="kpi-label">Avg Quote Value</span>
										<span class="kpi-trend kpi-trend-flat" id="avg-value-trend">-</span>
									</div>
									<div class="kpi-value" id="kpi-avg-value">$0.00</div>
									<div class="kpi-footer">
										<div class="kpi-progress">
											<div class="kpi-progress-bar" id="avg-value-progress" style="width: 0%"></div>
										</div>
										<span class="kpi-target" id="avg-value-target">Target: $850</span>
									</div>
								</div>
							</div>
						</div>

						<!-- Revenue Trend Chart -->
						<div class="card" style="margin-top: 1.5rem;">
							<div class="card-header">
								<h3 class="card-title">Revenue Trend</h3>
								<div class="card-actions">
									<select class="form-select-sm" id="revenue-chart-grouping" aria-label="Select chart grouping">
										<option value="day">Daily</option>
										<option value="week">Weekly</option>
										<option value="month">Monthly</option>
									</select>
								</div>
							</div>
							<div class="card-body">
								<canvas id="revenue-trend-chart" height="80" aria-label="Revenue trend chart"></canvas>
							</div>
						</div>

						<!-- Two Column Layout -->
						<div class="analytics-grid">
							<!-- Conversion Funnel -->
							<div class="card">
								<div class="card-header">
									<h3 class="card-title">Conversion Funnel</h3>
								</div>
								<div class="card-body">
									<canvas id="conversion-funnel-chart" height="120" aria-label="Conversion funnel chart"></canvas>
								</div>
							</div>

							<!-- Service Breakdown -->
							<div class="card">
								<div class="card-header">
									<h3 class="card-title">Revenue by Service</h3>
								</div>
								<div class="card-body">
									<canvas id="service-breakdown-chart" height="120" aria-label="Service breakdown chart"></canvas>
								</div>
							</div>
						</div>

						<!-- Detailed Metrics Tables -->
						<div class="card" style="margin-top: 1.5rem;">
							<div class="card-header">
								<h3 class="card-title">Detailed Metrics</h3>
							</div>
							<div class="card-body">
								<div class="metrics-tabs">
									<button class="tab-btn active" onclick="showAnalyticsMetricsTab('financial')" aria-label="Financial metrics">Financial</button>
									<button class="tab-btn" onclick="showAnalyticsMetricsTab('sales')" aria-label="Sales metrics">Sales</button>
									<button class="tab-btn" onclick="showAnalyticsMetricsTab('operations')" aria-label="Operations metrics">Operations</button>
									<button class="tab-btn" onclick="showAnalyticsMetricsTab('customers')" aria-label="Customer metrics">Customers</button>
								</div>

								<div class="metrics-content">
									<div id="metrics-financial" class="metrics-tab-content active">
										<table class="metrics-table">
											<thead>
												<tr>
													<th>Metric</th>
													<th>Current</th>
													<th>Target</th>
													<th>Change</th>
												</tr>
											</thead>
											<tbody id="financial-metrics-body">
												<!-- Populated by JavaScript -->
											</tbody>
										</table>
									</div>

									<div id="metrics-sales" class="metrics-tab-content">
										<table class="metrics-table">
											<thead>
												<tr>
													<th>Metric</th>
													<th>Current</th>
													<th>Target</th>
													<th>Change</th>
												</tr>
											</thead>
											<tbody id="sales-metrics-body">
												<!-- Populated by JavaScript -->
											</tbody>
										</table>
									</div>

									<div id="metrics-operations" class="metrics-tab-content">
										<table class="metrics-table">
											<thead>
												<tr>
													<th>Metric</th>
													<th>Current</th>
													<th>Target</th>
													<th>Change</th>
												</tr>
											</thead>
											<tbody id="operations-metrics-body">
												<!-- Populated by JavaScript -->
											</tbody>
										</table>
									</div>

									<div id="metrics-customers" class="metrics-tab-content">
										<table class="metrics-table">
											<thead>
												<tr>
													<th>Metric</th>
													<th>Current</th>
													<th>Target</th>
													<th>Change</th>
												</tr>
											</thead>
											<tbody id="customers-metrics-body">
												<!-- Populated by JavaScript -->
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</section>

				<!-- SAVED QUOTES PANEL -->
				<section class="section" id="savedQuotesPanel">
					<header class="sec-h">
						<h2 class="sec-title">Saved Quotes</h2>
						<button class="card-toggle" type="button" data-target="savedQuotesBody">‚ñæ</button>
					</header>
					<div class="sec-b" id="savedQuotesBody">
						<div class="saved-quotes-row">
							<select id="savedQuotesSelect" class="saved-quotes-select">
								<option value="">Select Saved Quote...</option>
							</select>
							<button id="loadSavedQuoteBtn" type="button" class="btn btn-sm">
								Load
							</button>
							<button id="deleteSavedQuoteBtn" type="button" class="btn btn-sm btn-tertiary">
								Delete
							</button>
						</div>
						<p class="saved-quotes-help">
							Quotes are stored in your browser only. Use this section to quickly reload regular
							jobs or typical setups.
						</p>
					</div>
				</section>
			</section>
		</main>
	</div> <!-- /.app -->

	<!-- TASK DASHBOARD PAGE (Hidden by default) -->
	<div class="page" id="page-tasks" style="display: none;">
		<div class="container">
			<!-- Header -->
			<div class="page-header">
				<h1>Tasks & Follow-ups</h1>
				<button class="btn btn-primary btn-sm" onclick="showNewTaskModal()" aria-label="Create new task">
					+ New Task
				</button>
			</div>

			<!-- Task Summary Cards -->
			<div class="task-summary-grid">
				<div class="card card-clickable" onclick="filterTasks('today')" role="button" tabindex="0" aria-label="View tasks due today">
					<div class="card-body">
						<div class="task-summary-label">Due Today</div>
						<div class="task-summary-value" id="tasks-today">0</div>
					</div>
				</div>

				<div class="card card-clickable" onclick="filterTasks('overdue')" role="button" tabindex="0" aria-label="View overdue tasks">
					<div class="card-body">
						<div class="task-summary-label">Overdue</div>
						<div class="task-summary-value task-overdue" id="tasks-overdue">0</div>
					</div>
				</div>

				<div class="card card-clickable" onclick="filterTasks('urgent')" role="button" tabindex="0" aria-label="View urgent tasks">
					<div class="card-body">
						<div class="task-summary-label">Urgent</div>
						<div class="task-summary-value task-urgent" id="tasks-urgent">0</div>
					</div>
				</div>

				<div class="card card-clickable" onclick="filterTasks('pending')" role="button" tabindex="0" aria-label="View pending tasks">
					<div class="card-body">
						<div class="task-summary-label">Pending</div>
						<div class="task-summary-value" id="tasks-pending">0</div>
					</div>
				</div>
			</div>

			<!-- Task Filters -->
			<div class="card" style="margin-bottom: 1.5rem;">
				<div class="card-body">
					<div class="task-filters">
						<select class="form-select" id="task-status-filter" aria-label="Filter by status">
							<option value="all">All Status</option>
							<option value="pending">Pending</option>
							<option value="in-progress">In Progress</option>
							<option value="overdue">Overdue</option>
							<option value="completed">Completed</option>
						</select>

						<select class="form-select" id="task-priority-filter" aria-label="Filter by priority">
							<option value="all">All Priorities</option>
							<option value="urgent">Urgent</option>
							<option value="high">High</option>
							<option value="normal">Normal</option>
							<option value="low">Low</option>
						</select>

						<select class="form-select" id="task-type-filter" aria-label="Filter by type">
							<option value="all">All Types</option>
							<option value="follow-up">Follow-up</option>
							<option value="phone-call">Phone Call</option>
							<option value="email">Email</option>
							<option value="sms">SMS</option>
						</select>
					</div>
				</div>
			</div>

			<!-- Task List -->
			<div id="task-list">
				<!-- Populated by JavaScript -->
			</div>

			<!-- Empty State -->
			<div id="tasks-empty-state" class="empty-state" style="display: none;">
				<svg class="empty-state-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
				</svg>
				<h3 class="empty-state-title">No Tasks</h3>
				<p class="empty-state-message">All caught up! No pending tasks at the moment.</p>
			</div>
		</div>
	</div>

	<!-- WIZARD OVERLAY -->
	<div id="wizardOverlay" class="wizard-overlay">
		<div class="wizard-dialog">
			<div class="wizard-header">
				<h2 id="wizardTitle">Wizard</h2>
				<button id="wizardCloseBtn" type="button" class="wizard-close">√ó</button>
			</div>
			<div id="wizardContent" class="wizard-content">
				<!-- Filled dynamically by wizard.js -->
			</div>
		</div>
	</div>

	<!-- WEBHOOK SETTINGS MODAL -->
	<div id="webhookSettingsModal" class="wizard-overlay" style="display: none;">
		<div class="wizard-dialog" style="max-width: 800px;">
			<div class="wizard-header">
				<h2>Webhook Settings</h2>
				<button id="webhookSettingsCloseBtn" type="button" class="wizard-close" onclick="closeWebhookSettings()">√ó</button>
			</div>
			<div class="wizard-content">
				<!-- Sync Status Card -->
				<div class="card" style="margin-bottom: 1.5rem;">
					<div class="card-header">
						<h3 class="card-title">Sync Status</h3>
					</div>
					<div class="card-body">
						<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
							<div>
								<div style="color: #6b7280; font-size: 0.875rem; margin-bottom: 0.25rem;">Status</div>
								<div id="sync-status" style="font-weight: 500;">
									<span class="status-dot status-dot-neutral"></span> Disabled
								</div>
							</div>
							<div>
								<div style="color: #6b7280; font-size: 0.875rem; margin-bottom: 0.25rem;">Last Sync</div>
								<div id="last-sync-time" style="font-weight: 500;">Never</div>
							</div>
							<div>
								<div style="color: #6b7280; font-size: 0.875rem; margin-bottom: 0.25rem;">Pending Events</div>
								<div id="pending-events" style="font-weight: 500;">0</div>
							</div>
							<div>
								<button class="btn btn-primary btn-block" onclick="triggerManualSync()" style="margin-top: 1.25rem;">
									Sync Now
								</button>
							</div>
						</div>
					</div>
				</div>

				<!-- Webhook Configuration -->
				<div class="card" style="margin-bottom: 1.5rem;">
					<div class="card-header">
						<h3 class="card-title">Webhook Configuration</h3>
					</div>
					<div class="card-body">
						<div class="form-group">
							<label class="form-label" for="webhook-url">Webhook URL</label>
							<input
								type="url"
								class="form-input"
								id="webhook-url"
								placeholder="https://your-worker.workers.dev"
							>
							<span class="form-hint">Your Cloudflare Worker or backend webhook endpoint</span>
						</div>

						<div class="form-group">
							<label class="form-label" for="webhook-secret">Webhook Secret</label>
							<input
								type="password"
								class="form-input"
								id="webhook-secret"
								placeholder="Enter webhook secret"
							>
							<span class="form-hint">Secret key for webhook signature verification</span>
						</div>

						<div class="form-group">
							<label class="form-checkbox-wrapper">
								<input
									type="checkbox"
									class="form-checkbox"
									id="webhook-enabled"
									checked
								>
								<span>Enable real-time sync</span>
							</label>
						</div>

						<div class="form-group">
							<label class="form-checkbox-wrapper">
								<input
									type="checkbox"
									class="form-checkbox"
									id="bidirectional-sync"
									checked
								>
								<span>Bidirectional sync (sync changes both ways)</span>
							</label>
						</div>

						<div class="form-group">
							<label class="form-label" for="conflict-resolution">Conflict Resolution</label>
							<select class="form-select" id="conflict-resolution">
								<option value="timestamp">Most recent wins (recommended)</option>
								<option value="ghl-wins">GoHighLevel always wins</option>
								<option value="local-wins">Local always wins</option>
								<option value="manual">Manual resolution</option>
							</select>
						</div>

						<button class="btn btn-primary" onclick="saveWebhookSettings()">
							Save Settings
						</button>
						<button class="btn btn-secondary" onclick="testWebhookEndpoint()" style="margin-left: 0.5rem;">
							Test Endpoint
						</button>
					</div>
				</div>

				<!-- Event Subscriptions -->
				<div class="card" style="margin-bottom: 1.5rem;">
					<div class="card-header">
						<h3 class="card-title">Event Subscriptions</h3>
					</div>
					<div class="card-body">
						<p class="form-hint" style="margin-bottom: 1rem;">
							Select which events should trigger sync updates
						</p>

						<div class="event-subscriptions-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.75rem;">
							<label class="form-checkbox-wrapper">
								<input type="checkbox" class="form-checkbox" value="ContactUpdate" checked>
								<span>Contact Updates</span>
							</label>

							<label class="form-checkbox-wrapper">
								<input type="checkbox" class="form-checkbox" value="OpportunityUpdate" checked>
								<span>Opportunity Updates</span>
							</label>

							<label class="form-checkbox-wrapper">
								<input type="checkbox" class="form-checkbox" value="TaskUpdate" checked>
								<span>Task Updates</span>
							</label>

							<label class="form-checkbox-wrapper">
								<input type="checkbox" class="form-checkbox" value="NoteCreate" checked>
								<span>New Notes</span>
							</label>

							<label class="form-checkbox-wrapper">
								<input type="checkbox" class="form-checkbox" value="InboundMessage">
								<span>Inbound Messages (SMS/Email)</span>
							</label>

							<label class="form-checkbox-wrapper">
								<input type="checkbox" class="form-checkbox" value="AppointmentUpdate">
								<span>Appointment Updates</span>
							</label>
						</div>
					</div>
				</div>

				<!-- GHL Registration -->
				<div class="card">
					<div class="card-header">
						<h3 class="card-title">GoHighLevel Registration</h3>
					</div>
					<div class="card-body">
						<p class="form-hint" style="margin-bottom: 1rem;">
							Register your webhook endpoint with GoHighLevel to start receiving real-time updates.
						</p>

						<div style="display: flex; gap: 0.5rem;">
							<button class="btn btn-primary" onclick="registerWebhookWithGHL()">
								Register Webhook
							</button>
							<button class="btn btn-tertiary" onclick="unregisterWebhookFromGHL()">
								Unregister
							</button>
							<button class="btn btn-secondary" onclick="viewEventQueue()">
								View Queue
							</button>
							<button class="btn btn-tertiary" onclick="clearEventQueue()">
								Clear Queue
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>


	<!-- TEST RUNNER MODAL -->
	<div id="testRunnerModal" class="modal" style="display: none;">
		<div class="modal-dialog" style="max-width: 1200px;">
			<div class="modal-content">
				<div class="modal-header">
					<h2 class="modal-title">üß™ Test & QA Suite</h2>
					<button class="modal-close" onclick="closeTestRunner()" aria-label="Close test runner">√ó</button>
				</div>

				<div class="modal-body">
					<!-- Test Actions -->
					<div class="test-actions">
						<button id="run-all-tests-btn" class="btn btn-primary" onclick="TestRunner.runAllTests()">
							Run All Tests
						</button>
						<button id="run-unit-tests-btn" class="btn btn-secondary" onclick="TestRunner.runUnitTests()">
							Unit Tests
						</button>
						<button id="run-integration-tests-btn" class="btn btn-secondary" onclick="TestRunner.runIntegrationTests()">
							Integration Tests
						</button>
						<button id="run-performance-tests-btn" class="btn btn-secondary" onclick="TestRunner.runPerformanceTests()">
							Performance Tests
						</button>
						<button id="clear-console-btn" class="btn btn-tertiary" onclick="TestRunner.clearTestConsole()">
							Clear Console
						</button>
						<button id="download-results-btn" class="btn btn-tertiary" onclick="TestRunner.downloadTestResults()">
							Download Results
						</button>
					</div>

					<!-- Test Results Summary -->
					<div class="card" id="test-results-summary" style="display: none; margin-bottom: 1.5rem;">
						<div class="card-body">
							<div class="test-results-grid">
								<div class="test-result-item">
									<div class="test-result-label">Total Tests</div>
									<div class="test-result-value" id="test-total">0</div>
								</div>
								<div class="test-result-item test-result-success">
									<div class="test-result-label">Passed</div>
									<div class="test-result-value" id="test-passed">0</div>
								</div>
								<div class="test-result-item test-result-danger">
									<div class="test-result-label">Failed</div>
									<div class="test-result-value" id="test-failed">0</div>
								</div>
								<div class="test-result-item test-result-neutral">
									<div class="test-result-label">Skipped</div>
									<div class="test-result-value" id="test-skipped">0</div>
								</div>
							</div>
							<div class="test-pass-rate">
								<div class="test-pass-rate-label">Pass Rate:</div>
								<div class="test-pass-rate-value" id="test-pass-rate">0%</div>
							</div>
						</div>
					</div>

					<!-- Test Console -->
					<div class="card" style="margin-bottom: 1.5rem;">
						<div class="card-header">
							<h3 class="card-title">Test Console</h3>
						</div>
						<div class="card-body">
							<pre id="test-console" class="test-console"></pre>
						</div>
					</div>

					<!-- Tabs for Checklist and Production Readiness -->
					<div class="tabs" style="margin-bottom: 1rem;">
						<button class="tab-btn active" onclick="showTestTab('checklist')">Manual Checklist</button>
						<button class="tab-btn" onclick="showTestTab('readiness')">Production Readiness</button>
					</div>

					<!-- Manual Test Checklist Tab -->
					<div id="test-tab-checklist" class="tab-content">
						<div class="card">
							<div class="card-header">
								<h3 class="card-title">Manual Test Checklist</h3>
								<div class="card-actions">
									<button id="export-checklist-btn" class="btn btn-tertiary btn-sm" onclick="TestChecklist.exportChecklistResults()">
										Export
									</button>
									<button id="reset-checklist-btn" class="btn btn-tertiary btn-sm" onclick="TestChecklist.resetChecklist()">
										Reset
									</button>
								</div>
							</div>
							<div class="card-body">
								<!-- Progress Bar -->
								<div class="checklist-progress">
									<div class="checklist-progress-label">
										<span>Progress</span>
										<span id="checklist-progress-text">0 / 0 (0%)</span>
									</div>
									<div class="checklist-progress-bar-container">
										<div id="checklist-progress-bar" class="checklist-progress-bar" style="width: 0%;" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
									</div>
								</div>

								<!-- Checklist Items -->
								<div id="manual-test-checklist">
									<!-- Populated by JavaScript -->
								</div>
							</div>
						</div>
					</div>

					<!-- Production Readiness Tab -->
					<div id="test-tab-readiness" class="tab-content" style="display: none;">
						<div class="card">
							<div class="card-header">
								<h3 class="card-title">Production Readiness Check</h3>
								<div class="card-actions">
									<button class="btn btn-primary btn-sm" onclick="runProductionReadinessCheck()">
										Run Check
									</button>
									<button class="btn btn-tertiary btn-sm" onclick="ProductionReadiness.exportReport()">
										Export Report
									</button>
								</div>
							</div>
							<div class="card-body">
								<p class="form-hint">
									Comprehensive production deployment readiness validation
								</p>
								<div id="production-readiness-results">
									<p style="text-align: center; color: var(--color-neutral-500); padding: 2rem;">
										Click "Run Check" to start the production readiness validation
									</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- SCRIPTS -->
	<!-- Bootstrap must load FIRST to create APP namespace -->
	<script src="bootstrap.js"></script>

	<!-- External dependencies -->
	<!-- Chart.js temporarily commented out for testing - network issues in test environment -->
	<!-- <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script> -->
	<!-- jsPDF for quote PDF generation -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>

	<!-- Core modules (load in dependency order) -->
	<!-- Debug system loads first (no defer - must be available immediately) -->
	<script src="debug.js"></script>
	<!-- Security utilities (no defer - must be available before other modules) -->
	<script src="security.js"></script>
	<!-- Validation system (no defer - must be available before invoice and other modules) -->
	<script src="validation.js"></script>
	<!-- UI Components (toast, loading, modals) - no defer for immediate availability -->
	<script src="ui-components.js"></script>
	<!-- Lazy loader for on-demand module loading -->
	<script src="lazy-loader.js"></script>
	<!-- Lazy loader initialization and event handlers -->
	<script src="lazy-loader-init.js" defer></script>
	<!-- Chart.js for analytics charts - loaded on demand by LazyLoader -->
	<!-- <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script> -->
	<!-- Enhanced Australian window types and modifiers (must load before data.js) -->
	<script src="window-types-extended.js" defer></script>
	<script src="conditions-modifiers.js" defer></script>
	<script src="pressure-surfaces-extended.js" defer></script>
	<script src="data.js" defer></script>
	<script src="quote-migration.js" defer></script>
	<script src="storage.js" defer></script>
	<script src="calc.js" defer></script>
	<script src="app.js" defer></script>

	<!-- Phase 2: Mobile UI Components -->
	<script src="quick-add-ui.js" defer></script>
	<script src="custom-window-calculator.js" defer></script>

	<!-- Phase 4: Business Intelligence -->
	<script src="travel-calculator.js" defer></script>
	<script src="profitability-analyzer.js" defer></script>

	<!-- Phase 5: Job Templates -->
	<script src="job-presets.js" defer></script>

	<!-- Task & Follow-up Automation (Prompt #29) -->
	<script src="followup-config.js" defer></script>
	<script src="task-manager.js" defer></script>
	<script src="followup-automation.js" defer></script>
	<script src="ghl-task-sync.js" defer></script>
	<script src="task-dashboard-ui.js" defer></script>

	<!-- UI and feature modules -->
	<script src="ui.js" defer></script>
	<script src="wizard.js" defer></script>
	<script src="loading.js" defer></script>
	<script src="accessibility.js" defer></script>
	<script src="client-database.js" defer></script>
	<script src="quote-workflow.js" defer></script>
	<script src="import-export.js" defer></script>
	<script src="invoice.js" defer></script>
	<!-- GoHighLevel Integration & Webhook Modules -->
	<script src="ghl-client.js" defer></script>
	<script src="ghl-integration.js" defer></script>
	<script src="task-manager.js" defer></script>
	<script src="followup-automation.js" defer></script>
	<script src="webhook-processor.js" defer></script>
	<script src="ghl-webhook-setup.js" defer></script>
	<script src="webhook-settings.js" defer></script>
	<script src="webhook-debug.js" defer></script>
	<script src="theme.js" defer></script>
	<script src="theme-customizer.js" defer></script>
	<script src="shortcuts.js" defer></script>
	<script src="error-handler.js" defer></script>
	<script src="export.js" defer></script>
	<script src="templates.js" defer></script>
	<!-- PDF Generation Modules -->
	<script src="pdf-config.js" defer></script>
	<script src="pdf-components.js" defer></script>
	<script src="quote-pdf.js" defer></script>
	<script src="quote-pdf-ui.js" defer></script>
	<!-- Lazy-loaded modules (loaded on demand via LazyLoader) -->
	<!-- Analytics System -->
	<script src="analytics-config.js" defer></script>
	<script src="analytics-engine.js" defer></script>
	<script src="analytics-dashboard.js" defer></script>
	<script src="analytics.js" defer></script>
	<!-- <script src="charts.js" defer></script> -->
	<!-- <script src="photo-modal.js" defer></script> -->
	<script src="photos.js" defer></script>

	<!-- Production Polish & Testing Tools -->
	<!-- Deployment helper for pre-deployment checks -->
	<script src="deployment-helper.js" defer></script>
	<!-- Health monitoring for production environment -->
	<script src="health-check.js" defer></script>
	<!-- Bug tracking and reporting system -->
	<script src="bug-tracker.js" defer></script>
	<!-- Test Framework & QA Tools -->
	<script src="test-framework.js" defer></script>
	<script src="test-suites.js" defer></script>
	<script src="integration-tests.js" defer></script>
	<script src="performance-tests.js" defer></script>
	<script src="test-runner.js" defer></script>
	<script src="test-checklist.js" defer></script>
	<script src="production-readiness.js" defer></script>

	<!-- Backup & Restore System -->
	<script src="backup-manager.js" defer></script>

	<!-- Production Configuration (loads last to override development settings) -->
	<script src="config-production.js" defer></script>

	<!-- MANUAL TEST SUITES (uncomment for testing, comment out for production) -->
	<!-- Pricing calculation tests: PricingTests.runAll() -->
	<!-- <script src="tests/manual/pricing-tests.js" defer></script> -->
	<!-- Storage operation tests: StorageTests.runAll() -->
	<!-- <script src="tests/manual/storage-tests.js" defer></script> -->
	<!-- Performance benchmarks: PerformanceTests.runAll() -->
	<!-- <script src="tests/manual/performance-tests.js" defer></script> -->

	<!-- Webhook Settings Modal Functions -->
	<script>
		// Open webhook settings modal
		function openWebhookSettings() {
			var modal = document.getElementById('webhookSettingsModal');
			if (modal) {
				modal.style.display = 'flex';
				if (window.WebhookSettings && window.WebhookSettings.init) {
					window.WebhookSettings.init();
				}
			}
		}

		// Close webhook settings modal
		function closeWebhookSettings() {
			var modal = document.getElementById('webhookSettingsModal');
			if (modal) {
				modal.style.display = 'none';
				if (window.WebhookSettings && window.WebhookSettings.cleanup) {
					window.WebhookSettings.cleanup();
				}
			}
		}

		// Trigger manual sync
		function triggerManualSync() {
			if (window.WebhookSettings && window.WebhookSettings.triggerManualSync) {
				window.WebhookSettings.triggerManualSync();
			}
		}

		// Save webhook settings
		function saveWebhookSettings() {
			if (window.WebhookSettings && window.WebhookSettings.saveSettings) {
				window.WebhookSettings.saveSettings();
			}
		}

		// Test webhook endpoint
		function testWebhookEndpoint() {
			if (window.WebhookSettings && window.WebhookSettings.testWebhookEndpoint) {
				window.WebhookSettings.testWebhookEndpoint();
			}
		}

		// Register webhook with GHL
		function registerWebhookWithGHL() {
			if (window.WebhookSettings && window.WebhookSettings.registerWebhookWithGHL) {
				window.WebhookSettings.registerWebhookWithGHL();
			}
		}

		// Unregister webhook from GHL
		function unregisterWebhookFromGHL() {
			if (window.WebhookSettings && window.WebhookSettings.unregisterWebhookFromGHL) {
				window.WebhookSettings.unregisterWebhookFromGHL();
			}
		}

		// View event queue
		function viewEventQueue() {
			if (window.WebhookSettings && window.WebhookSettings.viewEventQueue) {
				window.WebhookSettings.viewEventQueue();
			}
		}

		// Clear event queue
		function clearEventQueue() {
			if (window.WebhookSettings && window.WebhookSettings.clearEventQueue) {
				window.WebhookSettings.clearEventQueue();
			}
		}

		// Close modal on overlay click
		document.addEventListener('DOMContentLoaded', function() {
			var modal = document.getElementById('webhookSettingsModal');
			if (modal) {
				modal.addEventListener('click', function(e) {
					if (e.target === modal) {
						closeWebhookSettings();
					}
				});
			}
		});
	</script>

	<!-- Test Runner Functions -->
	<script>
		// Open test runner modal
		function openTestRunner() {
			var modal = document.getElementById('testRunnerModal');
			if (modal) {
				modal.style.display = 'flex';
				document.body.classList.add('modal-open');
			}
		}

		// Close test runner modal
		function closeTestRunner() {
			var modal = document.getElementById('testRunnerModal');
			if (modal) {
				modal.style.display = 'none';
				document.body.classList.remove('modal-open');
			}
		}

		// Show test tab
		function showTestTab(tabName) {
			// Hide all tabs
			var tabs = document.querySelectorAll('.tab-content');
			for (var i = 0; i < tabs.length; i++) {
				tabs[i].style.display = 'none';
			}

			// Remove active class from all buttons
			var btns = document.querySelectorAll('#testRunnerModal .tab-btn');
			for (var i = 0; i < btns.length; i++) {
				btns[i].classList.remove('active');
			}

			// Show selected tab
			var selectedTab = document.getElementById('test-tab-' + tabName);
			if (selectedTab) {
				selectedTab.style.display = 'block';
			}

			// Add active class to clicked button
			var clickedBtn = event.target;
			if (clickedBtn) {
				clickedBtn.classList.add('active');
			}
		}

		// Run production readiness check and display results
		function runProductionReadinessCheck() {
			if (typeof ProductionReadiness === 'undefined') {
				alert('Production readiness checker not loaded');
				return;
			}

			if (typeof UIComponents !== 'undefined' && UIComponents.showLoading) {
				UIComponents.showLoading('Running production readiness check...');
			}

			setTimeout(function() {
				var results = ProductionReadiness.runCheck();

				if (typeof UIComponents !== 'undefined' && UIComponents.hideLoading) {
					UIComponents.hideLoading();
				}

				// Display results
				displayReadinessResults(results);
			}, 100);
		}

		// Display readiness results
		function displayReadinessResults(results) {
			var container = document.getElementById('production-readiness-results');
			if (!container) return;

			var scoreClass = 'not-ready';
			var scoreLabel = 'NOT READY';
			if (results.score === 100) {
				scoreClass = 'ready';
				scoreLabel = 'PRODUCTION READY ‚úì';
			} else if (results.score >= 90) {
				scoreClass = 'mostly-ready';
				scoreLabel = 'MOSTLY READY';
			} else if (results.score >= 75) {
				scoreClass = 'caution';
				scoreLabel = 'CAUTION';
			}

			var html = '';
			html += '<div class="readiness-score ' + scoreClass + '">' + results.score + '/100</div>';
			html += '<p style="text-align: center; font-size: 1.25rem; font-weight: 600; margin-bottom: 2rem;">' + scoreLabel + '</p>';

			if (results.passed.length > 0) {
				html += '<div class="readiness-section">';
				html += '<h4 class="readiness-section-title">‚úì Passed (' + results.passed.length + ')</h4>';
				html += '<ul class="readiness-list">';
				for (var i = 0; i < results.passed.length; i++) {
					html += '<li class="passed">‚úì ' + escapeHtml(results.passed[i]) + '</li>';
				}
				html += '</ul></div>';
			}

			if (results.warnings.length > 0) {
				html += '<div class="readiness-section">';
				html += '<h4 class="readiness-section-title">‚ö†Ô∏è Warnings (' + results.warnings.length + ')</h4>';
				html += '<ul class="readiness-list">';
				for (var i = 0; i < results.warnings.length; i++) {
					html += '<li class="warning">‚ö†Ô∏è ' + escapeHtml(results.warnings[i]) + '</li>';
				}
				html += '</ul></div>';
			}

			if (results.failed.length > 0) {
				html += '<div class="readiness-section">';
				html += '<h4 class="readiness-section-title">‚úó Failed (' + results.failed.length + ')</h4>';
				html += '<ul class="readiness-list">';
				for (var i = 0; i < results.failed.length; i++) {
					html += '<li class="failed">‚úó ' + escapeHtml(results.failed[i]) + '</li>';
				}
				html += '</ul></div>';
			}

			container.innerHTML = html;
		}

		// HTML escape helper
		function escapeHtml(text) {
			var div = document.createElement('div');
			div.textContent = text;
			return div.innerHTML;
		}

		// Close modal on overlay click
		document.addEventListener('DOMContentLoaded', function() {
			var modal = document.getElementById('testRunnerModal');
			if (modal) {
				modal.addEventListener('click', function(e) {
					if (e.target === modal) {
						closeTestRunner();
					}
				});
			}
		});
	</script>

	<!-- Service Worker Registration -->
	<script>
		// Register service worker for PWA offline support
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', function() {
				navigator.serviceWorker.register('/sw.js')
					.then(function(registration) {
						console.log('ServiceWorker registered: ', registration.scope);
					})
					.catch(function(error) {
						console.log('ServiceWorker registration failed: ', error);
					});
			});
		}
	</script>
</body>

</html>