<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<title>Tic-Tac-Stick Quote Engine</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
	<meta name="description" content="Professional quoting tool for 925 Pressure Glass - Window & Pressure Cleaning" />
	<meta name="theme-color" content="#7c3aed" />

	<!-- Content Security Policy -->
	<meta http-equiv="Content-Security-Policy" content="
		default-src 'self';
		script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://unpkg.com capacitor: ionic:;
		style-src 'self' 'unsafe-inline';
		img-src 'self' data: blob: capacitor:;
		font-src 'self';
		connect-src 'self' https://*.workers.dev https://services.leadconnectorhq.com https://rest.gohighlevel.com capacitor: ionic: http: https:;
		object-src 'none';
		base-uri 'self';
		form-action 'self';
		frame-ancestors 'none';
	">

	<!-- PWA Manifest -->
	<link rel="manifest" href="manifest.json" />

	<!-- Favicon -->
	<link rel="icon" type="image/png" sizes="32x32" href="favicon.png" />
	<link rel="icon" type="image/svg+xml" href="icon.svg" />

	<!-- Apple Touch Icon -->
	<link rel="apple-touch-icon" href="icon-192.png" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
	<meta name="apple-mobile-web-app-title" content="Quote Engine" />

	<!-- Test mode flag (used by Playwright automation) -->
	<script>
		(function() {
			var isTest = window.location.search.indexOf('testMode=1') !== -1 || navigator.webdriver === true || window.APP_TEST_MODE;
			window.APP_TEST_MODE = !!isTest;
			if (!window.APP_TEST_MODE) {
				return;
			}

			// Stub fetch for external URLs to prevent hanging requests
			var originalFetch = window.fetch;
			window.fetch = function(input, init) {
				var url = '';
				if (typeof input === 'string') {
					url = input;
				} else if (input && typeof input.url === 'string') {
					url = input.url;
				}
				if (url && url.indexOf('http') === 0 && url.indexOf(window.location.origin) !== 0) {
					return Promise.resolve(new Response('{}', {
						status: 200,
						headers: {
							'Content-Type': 'application/json'
						}
					}));
				}
				if (originalFetch) {
					return originalFetch.call(this, input, init);
				}
				return Promise.resolve(new Response('{}', { status: 200 }));
			};

			// Stub XMLHttpRequest for external URLs
			var OriginalXHR = window.XMLHttpRequest;
			if (OriginalXHR) {
				function StubbedXHR() {
					var xhr = new OriginalXHR();
					var originalOpen = xhr.open;
					var originalSend = xhr.send;
					xhr.open = function(method, url) {
						this._stubUrl = url;
						return originalOpen.apply(this, arguments);
					};
					xhr.send = function(body) {
						var url = this._stubUrl || '';
						if (url.indexOf('http') === 0 && url.indexOf(window.location.origin) !== 0) {
							this.readyState = 4;
							this.status = 200;
							this.responseText = '{}';
							if (typeof this.onreadystatechange === 'function') {
								this.onreadystatechange();
							}
							if (typeof this.onload === 'function') {
								this.onload();
							}
							return;
						}
						return originalSend.apply(this, arguments);
					};
					return xhr;
				}
				window.XMLHttpRequest = StubbedXHR;
			}
		})();
	</script>

	<!-- CSS -->
	<!-- Design System - Load FIRST to provide CSS variables and base styles -->
        <link rel="stylesheet" href="css/design-system.css" />
        <link rel="stylesheet" href="app.css" />
        <link rel="stylesheet" href="toast.css" />
        <link rel="stylesheet" href="loading.css" />
        <link rel="preload" as="style" href="photo-modal.css" data-late-style="true" />
	<link rel="stylesheet" href="client-database.css" />
	<link rel="stylesheet" href="quote-workflow.css" />
	<link rel="stylesheet" href="import-export.css" />
	<link rel="stylesheet" href="invoice.css" />
	<link rel="stylesheet" href="validation.css" />
        <link rel="stylesheet" href="shortcuts.css" />
        <link rel="stylesheet" href="theme-light.css" />
        <link rel="stylesheet" href="theme-customizer.css" />
        <link rel="preload" as="style" href="analytics.css" data-late-style="true" />
        <link rel="preload" as="style" href="css/analytics-dashboard.css" data-late-style="true" />
        <link rel="preload" as="style" href="photos.css" data-late-style="true" />
	<link rel="stylesheet" href="css/tasks.css" />
	<link rel="stylesheet" href="css/contracts.css" />
	<link rel="stylesheet" href="css/help-system.css" />
	<link rel="stylesheet" href="css/ghl-settings.css" />
	<link rel="stylesheet" href="css/csv-import.css" />
	<link rel="stylesheet" href="css/selective-export.css" />
	<link rel="stylesheet" href="mobile.css" />
	<link rel="stylesheet" href="quote-pdf.css" />
	<link rel="stylesheet" href="css/job-tracking.css" />
	<link rel="stylesheet" href="css/test-runner.css" />
	<link rel="stylesheet" href="print.css" media="print" />
	<link rel="stylesheet" href="invoice-print.css" media="print" />
	<link rel="stylesheet" href="photo-print-layout.css" media="print" />
	<link rel="stylesheet" href="letterhead.css" media="print" />
</head>

<body class="accordion-mode">
	<div class="app">
		<!-- HEADER -->
		<header class="hdr">
			<div class="hdr-row hdr-row-top">
				<div class="hdr-brand">
					<div class="hdr-ic">üßΩ</div>
					<div class="hdr-info">
						<div class="hdr-title">Tic-Tac-Stick Quote Engine</div>
						<div class="hdr-subtitle">925 Pressure Glass ¬∑ Window & Pressure Cleaning</div>
					</div>
				</div>
				<button id="actionMenuToggle" type="button" class="btn btn-ghost btn-small hdr-actions-toggle" aria-expanded="false" aria-controls="hdrActions">
					‚ò∞ Actions
				</button>
				<div class="hdr-actions" id="hdrActions">
					<button id="toggleModeBtn" type="button" class="btn btn-accent" aria-label="Switch to wizard mode">
						ü™Ñ Wizard Mode
					</button>
					<button id="webhookSettingsBtn" type="button" class="btn btn-secondary" title="GoHighLevel Integration Settings" aria-label="Open GHL settings" onclick="if(window.openGHLSettings) { window.openGHLSettings(); } else { alert('GHL Settings module not loaded yet'); }">
						üîÑ GHL
					</button>
					<button id="customersPageBtn" type="button" class="btn btn-secondary" title="Customer Directory" aria-label="Open customer directory" onclick="showCustomersPage()">
						üë• Customers
					</button>
					<button id="jobsPageBtn" type="button" class="btn btn-secondary" title="Job Tracking" aria-label="Open jobs page" onclick="navigateTo('jobs')">
					üìã Jobs
				</button>
				<button id="contractsPageBtn" type="button" class="btn btn-secondary" title="Contract Management" aria-label="Open contracts page" onclick="navigateTo('contracts')">
					üìù Contracts
				</button>
				<button id="analyticsPageBtn" type="button" class="btn btn-secondary" title="Analytics Dashboard" aria-label="Open analytics dashboard" onclick="navigateTo('analytics-dashboard')">
					üìä Analytics
				</button>
				<button id="helpPageBtn" type="button" class="btn btn-tertiary" title="Help & Documentation" aria-label="Open help system" onclick="navigateTo('help')">
					‚ùì Help
				</button>
					<button id="settingsPageBtn" type="button" class="btn btn-tertiary" title="Settings & Backup" aria-label="Open settings" onclick="navigateTo('settings')">
						‚öôÔ∏è Settings
					</button>
					<button id="invoiceSettingsBtn" type="button" class="btn btn-tertiary" title="Invoice Settings" aria-label="Open invoice settings" onclick="if(window.InvoiceSystem && window.InvoiceSystem.showSettingsModal){ window.InvoiceSystem.showSettingsModal(); } else { alert('Invoice settings not available'); }">
						üßæ Invoice Settings
					</button>
					<button id="keyboardShortcutsBtn" type="button" class="btn btn-tertiary" title="Keyboard Shortcuts (Press ?)" aria-label="View keyboard shortcuts" style="display: none;">
						‚å®Ô∏è Shortcuts
					</button>
					<button id="testRunnerBtn" type="button" class="btn btn-tertiary" title="Test & QA Suite" aria-label="Open test runner" onclick="openTestRunner()">
						üß™ Tests
					</button>
					<button id="clearAllBtn" type="button" class="btn btn-tertiary" aria-label="Clear all quote data">
						üóëÔ∏è Clear All
					</button>
				</div>
			</div>
			<div class="hdr-row hdr-row-meta">
				<div class="hdr-meta">
					<label class="hdr-meta-field">
						<span>Quote Title</span>
						<input id="quoteTitleInput" type="text" placeholder="e.g. Zoe Williams ‚Äì Balcony Glass & External Doors" aria-label="Quote title" />
					</label>
					<label class="hdr-meta-field">
						<span>Client Name</span>
						<input id="clientNameInput" type="text" placeholder="Client name" aria-label="Client name" />
					</label>
					<label class="hdr-meta-field">
						<span>Client Location / Area</span>
						<div style="display: flex; gap: 0.5rem; align-items: center;">
							<input id="clientLocationInput" type="text" placeholder="Suburb / area" aria-label="Client location or area" style="flex: 1;" />
							<button type="button" class="btn btn-sm btn-secondary" onclick="fillCurrentLocation()" title="Use my current location" aria-label="Fill with current location">
								üìç
							</button>
						</div>
					</label>
					<label class="hdr-meta-field">
						<span>Job Type</span>
						<select id="jobTypeInput" aria-label="Select job type">
							<option value="">Select...</option>
							<option value="residential">Residential Windows</option>
							<option value="commercial">Commercial Windows</option>
							<option value="pressure">Pressure Cleaning</option>
							<option value="mixed">Mixed Windows & Pressure</option>
						</select>
					</label>
				</div>
			</div>
		</header>

                <!-- MAIN -->
                <main class="main" id="mainContent">
                        <section class="workspace-panel" aria-labelledby="quoteWorkspaceHeading">
                                <header class="workspace-header">
                                        <div class="workspace-titles">
                                                <p class="workspace-eyebrow">Quote Builder</p>
                                                <h1 class="workspace-title" id="quoteWorkspaceHeading">Build the quote, capture job details, and review totals</h1>
                                        </div>
                                        <div class="workspace-status" aria-live="polite" role="status" id="workspaceStatusLive"></div>
                                </header>

                                <div class="panel-grid" role="presentation">
                                        <!-- LEFT COLUMN -->
                                        <section class="col col-left" aria-labelledby="builderColumnHeading">
                                                <header class="col-header" id="builderColumnHeading">
                                                        <h2 class="col-title">Job setup & line items</h2>
                                                        <p class="col-description">Configure rates, add windows or pressure cleaning lines, and keep items organized.</p>
                                                </header>

                                                <!-- CONFIG PANEL -->
				<section class="section" id="configPanel">
					<header class="sec-h">
						<h2 class="sec-title">‚öôÔ∏è Job Settings</h2>
						<button class="card-toggle" type="button" data-target="configBody">‚ñæ</button>
					</header>
					<div class="sec-b" id="configBody">
						<div class="config-grid">
							<!-- BASE FEE -->
							<label class="field" data-help="base-fee">
								<span class="field-label">Base Callout Fee ($)</span>
								<input id="baseFeeInput" type="number" min="0" step="1" value="120" inputmode="decimal" />
								<small class="field-help">
									Covers travel & setup; always charged once per job.
								</small>
							</label>

							<!-- HOURLY RATE -->
							<label class="field" data-help="hourly-rate">
								<span class="field-label">Hourly Rate ($/hr)</span>
								<input id="hourlyRateInput" type="number" min="0" step="1" value="95" inputmode="decimal" />
								<small class="field-help">
									Used to convert time to labour cost.
								</small>
							</label>

							<!-- MINIMUM JOB -->
							<label class="field" data-help="minimum-job">
								<span class="field-label">Minimum Job Charge ($)</span>
								<input id="minimumJobInput" type="number" min="0" step="1" value="180" inputmode="decimal" />
								<small class="field-help">
									Final total will never drop below this amount.
								</small>
							</label>

							<!-- HIGH REACH MODIFIER -->
							<label class="field" data-help="high-reach">
								<span class="field-label">High Reach Modifier (%)</span>
								<input id="highReachModifierInput" type="number" min="0" step="5" value="60" inputmode="decimal" />
								<small class="field-help">
									Added as a % of exterior pane cost for high reach work.
								</small>
							</label>

							<!-- INSIDE / OUTSIDE MULTIPLIERS -->
							<label class="field">
								<span class="field-label">Inside Time Multiplier</span>
								<input id="insideMultiplierInput" type="number" min="0.5" step="0.1" value="1.0" inputmode="decimal" />
								<small class="field-help">Fine-tune inside pane timings.</small>
							</label>

							<label class="field">
								<span class="field-label">Outside Time Multiplier</span>
								<input id="outsideMultiplierInput" type="number" min="0.5" step="0.1" value="1.0" inputmode="decimal" />
								<small class="field-help">Fine-tune outside pane timings.</small>
							</label>

							<!-- PRESSURE CLEAN SETTINGS -->
							<label class="field">
								<span class="field-label">Pressure Clean Base Rate ($/hr)</span>
								<input id="pressureHourlyRateInput" type="number" min="0" step="1" value="120" inputmode="decimal" />
								<small class="field-help">
									Used for all surface time calculations.
								</small>
							</label>

							<label class="field">
								<span class="field-label">Travel / Setup Buffer (mins)</span>
								<input id="setupBufferMinutesInput" type="number" min="0" step="5" value="15" inputmode="numeric" />
								<small class="field-help">
									Added once per job to cover hose run, machine setup, etc.
								</small>
							</label>
						</div>

						<!-- AUTOSAVE & PRESETS -->
						<div class="config-footer">
							<label class="toggle">
								<input id="autosaveToggle" type="checkbox" checked />
								<span>Autosave this quote in browser</span>
							</label>
							<div class="config-footer-row">
								<select id="presetSelect" class="preset-select" aria-label="Load saved preset">
									<option value="">Load Preset...</option>
								</select>
								<button id="savePresetBtn" type="button" class="btn btn-sm btn-primary" aria-label="Save current settings as preset">
									üíæ Save Preset
								</button>
							</div>
							<div class="config-footer-row">
								<select id="templateSelect" class="preset-select" aria-label="Choose quote template">
									<option value="">Choose Template...</option>
								</select>
								<button id="saveTemplateBtn" type="button" class="btn btn-sm btn-secondary" aria-label="Save current quote as template">
									üìã Save Template
								</button>
							</div>
						</div>
					</div>
				</section>

				<!-- WINDOWS PANEL -->
				<section class="section" id="windowsPanel">
					<header class="sec-h">
						<h2 class="sec-title">ü™ü Windows</h2>
						<div class="card-hdr-actions">
								<button id="openWindowWizardBtn" type="button" class="btn btn-accent btn-sm" aria-label="Open window wizard for guided entry" onclick="if(window.Wizard && window.Wizard.openWindowWizard){ window.Wizard.openWindowWizard(); }">
									ü™Ñ Wizard
								</button>
							<button id="addWindowLineBtn" type="button" class="btn btn-sm btn-primary" aria-label="Add window line item manually">
								+ Add Line
							</button>
							<button class="card-toggle" type="button" data-target="windowsBody" aria-label="Toggle windows section" aria-expanded="true">‚ñæ</button>
						</div>
					</header>
                                        <div class="sec-b" id="windowsBody">
                                                <div class="lines-table-wrapper">
                                                        <table class="lines-table" id="windowLinesTable" aria-label="Window lines">
                                                                <thead>
                                                                        <tr>
                                                                                <th scope="col"><button type="button" class="sort-toggle" data-type="window" data-key="title">Title <span class="sort-icon" aria-hidden="true"></span></button></th>
                                                                                <th scope="col"><button type="button" class="sort-toggle" data-type="window" data-key="type">Type <span class="sort-icon" aria-hidden="true"></span></button></th>
                                                                                <th scope="col"><button type="button" class="sort-toggle" data-type="window" data-key="panes">Panes <span class="sort-icon" aria-hidden="true"></span></button></th>
                                                                                <th scope="col">Flags</th>
                                                                                <th scope="col"><button type="button" class="sort-toggle" data-type="window" data-key="condition">Condition <span class="sort-icon" aria-hidden="true"></span></button></th>
                                                                                <th scope="col"><button type="button" class="sort-toggle" data-type="window" data-key="access">Access <span class="sort-icon" aria-hidden="true"></span></button></th>
                                                                                <th scope="col">Tint</th>
                                                                                <th scope="col"><button type="button" class="sort-toggle" data-type="window" data-key="location">Location <span class="sort-icon" aria-hidden="true"></span></button></th>
                                                                                <th scope="col">Est.</th>
                                                                                <th scope="col" class="actions-col">Actions</th>
                                                                        </tr>
                                                                </thead>
                                                                <tbody id="windowLinesTableBody"></tbody>
                                                        </table>
                                                </div>
                                        </div>
                                </section>

				<!-- PRESSURE PANEL -->
				<section class="section" id="pressurePanel">
					<header class="sec-h">
						<h2 class="sec-title">üí¶ Pressure Cleaning</h2>
						<div class="card-hdr-actions">
								<button id="openPressureWizardBtn" type="button" class="btn btn-accent btn-sm" aria-label="Open pressure wizard for guided entry" onclick="if(window.Wizard && window.Wizard.openPressureWizard){ window.Wizard.openPressureWizard(); }">
									ü™Ñ Wizard
								</button>
							<button id="addPressureLineBtn" type="button" class="btn btn-sm btn-primary" aria-label="Add pressure cleaning line item manually">
								+ Add Line
							</button>
							<button class="card-toggle" type="button" data-target="pressureBody" aria-label="Toggle pressure cleaning section" aria-expanded="true">‚ñæ</button>
						</div>
					</header>
                                        <div class="sec-b" id="pressureBody">
                                                <div class="lines-table-wrapper">
                                                        <table class="lines-table" id="pressureLinesTable" aria-label="Pressure lines">
                                                                <thead>
                                                                        <tr>
                                                                                <th scope="col"><button type="button" class="sort-toggle" data-type="pressure" data-key="title">Title <span class="sort-icon" aria-hidden="true"></span></button></th>
                                                                                <th scope="col"><button type="button" class="sort-toggle" data-type="pressure" data-key="surface">Surface <span class="sort-icon" aria-hidden="true"></span></button></th>
                                                                                <th scope="col"><button type="button" class="sort-toggle" data-type="pressure" data-key="area">Area (sqm) <span class="sort-icon" aria-hidden="true"></span></button></th>
                                                                                <th scope="col"><button type="button" class="sort-toggle" data-type="pressure" data-key="soil">Soil <span class="sort-icon" aria-hidden="true"></span></button></th>
                                                                                <th scope="col"><button type="button" class="sort-toggle" data-type="pressure" data-key="access">Access <span class="sort-icon" aria-hidden="true"></span></button></th>
                                                                                <th scope="col">Notes</th>
                                                                                <th scope="col">Est.</th>
                                                                                <th scope="col" class="actions-col">Actions</th>
                                                                        </tr>
                                                                </thead>
                                                                <tbody id="pressureLinesTableBody"></tbody>
                                                        </table>
                                                </div>
                                        </div>
                                </section>
			</section>

			<!-- RIGHT COLUMN -->
			<section class="col col-right">
				<!-- SUMMARY PANEL -->
				<section class="section card-summary" id="summaryPanel">
					<header class="sec-h">
						<h2 class="sec-title">üí∞ Quote Summary</h2>
						<button class="card-toggle" type="button" data-target="summaryBody">‚ñæ</button>
					</header>
					<div class="sec-b" id="summaryBody">
						<div class="summary-main">
							<div class="summary-block">
								<div class="summary-label">Subtotal (excl. GST)</div>
								<div class="summary-value" id="subtotalDisplay">$0</div>
							</div>
							<div class="summary-block">
								<div class="summary-label">High Reach Adjustments</div>
								<div class="summary-value" id="highReachDisplay">$0</div>
							</div>
							<div class="summary-block">
								<div class="summary-label">GST (10%)</div>
								<div class="summary-value" id="gstDisplay">$0</div>
							</div>
							<div class="summary-block summary-block-total">
								<div class="summary-label">Final Total (incl. GST, inc. min job)</div>
								<div class="summary-value" id="totalIncGstDisplay">$0</div>
							</div>
						</div>

						<!-- QUOTE ACTION BUTTONS -->
						<div class="notes-footer" style="margin-top: 1.5rem;">
							<button id="generatePdfBtn" type="button" class="btn btn-accent">
								üìÑ Export PDF
							</button>
							<button id="copySummaryBtn" type="button" class="btn btn-secondary">
								üìã Copy Summary
							</button>
						</div>

						<div class="summary-sub">
							<div class="summary-sub-col">
								<h3>Time Estimate</h3>
								<p id="timeEstimateDisplay">0.00 hrs total</p>
								<ul class="summary-list">
									<li><span>Windows Time:</span> <span id="windowsTimeDisplay">0.00 hrs</span></li>
									<li><span>Pressure Time:</span> <span id="pressureTimeDisplay">0.00 hrs</span></li>
									<li><span>Setup / Travel:</span> <span id="setupTimeDisplay">0.00 hrs</span></li>
									<li><span>High Reach Extra:</span> <span id="highReachTimeDisplay">0.00 hrs</span></li>
								</ul>
							</div>
							<div class="summary-sub-col">
								<h3>Cost Breakdown</h3>
								<ul class="summary-list">
									<li><span>Base Callout:</span> <span id="baseFeeDisplay">$0</span></li>
									<li><span>Windows Labour:</span> <span id="windowsCostDisplay">$0</span></li>
									<li><span>Pressure Labour:</span> <span id="pressureCostDisplay">$0</span></li>
									<li><span>High Reach Premium:</span> <span id="highReachCostDisplay">$0</span></li>
									<li><span>Other Adjustments:</span> <span id="otherAdjustmentsDisplay">$0</span></li>
								</ul>
							</div>
						</div>

						<div class="summary-chart-wrap">
							<h3>Time Distribution</h3>
							<canvas id="timeChart" width="400" height="200"></canvas>
						</div>
					</div>
				</section>

				<!-- SAVED QUOTES PANEL -->
				<section class="section" id="savedQuotesPanel">
					<header class="sec-h">
						<h2 class="sec-title">üíæ Saved Quotes</h2>
						<button class="card-toggle" type="button" data-target="savedQuotesBody">‚ñæ</button>
					</header>
					<div class="sec-b" id="savedQuotesBody">
						<div class="saved-quotes-row">
							<button id="saveQuoteBtn" type="button" class="btn btn-sm btn-accent" aria-label="Save current quote">
								üíæ Save Current Quote
							</button>
						</div>
						<div class="saved-quotes-row" style="margin-top: 0.5rem;">
							<select id="savedQuotesSelect" class="saved-quotes-select">
								<option value="">Select Saved Quote...</option>
							</select>
							<button id="loadSavedQuoteBtn" type="button" class="btn btn-sm btn-primary">
								üìÇ Load
							</button>
							<button id="deleteSavedQuoteBtn" type="button" class="btn btn-sm btn-danger">
								üóëÔ∏è Delete
							</button>
						</div>
						<p class="saved-quotes-help">
							Quotes are stored in your browser only. Use this section to quickly reload regular
							jobs or typical setups.
						</p>
					</div>
				</section>

				<!-- NOTES PANEL -->
				<section class="section" id="notesPanel">
					<header class="sec-h">
						<h2 class="sec-title">üìù Notes</h2>
						<button class="card-toggle" type="button" data-target="notesBody">‚ñæ</button>
					</header>
					<div class="sec-b" id="notesBody">
						<label class="field">
							<span class="field-label">Internal Notes (for you)</span>
							<textarea id="internalNotesInput" rows="4" placeholder="E.g. ladder access required, tight balcony, recurring customer"></textarea>
						</label>

						<label class="field">
							<span class="field-label">Client-Facing Notes</span>
							<textarea id="clientNotesInput" rows="4" placeholder="E.g. Quote excludes flyscreen removal, valid for 14 days."></textarea>
						</label>
					</div>
				</section>

				<!-- PHOTOS PANEL -->
				<section class="section" id="photosSection">
					<header class="sec-h">
						<h2 class="sec-title">üì∑ Photos</h2>
						<button class="card-toggle" type="button" data-target="photosBody">‚ñæ</button>
					</header>
					<div class="sec-b" id="photosBody">
						<div id="photoGallery">
							<p class="photo-gallery-empty">No photos attached</p>
						</div>
					</div>
				</section>

				<!-- ANALYTICS PANEL -->
				<section class="section" id="analyticsPanel">
					<header class="sec-h">
						<h2 class="sec-title">üìä Quote History & Analytics</h2>
						<button class="card-toggle" type="button" data-target="analyticsBody">‚ñæ</button>
					</header>
					<div class="sec-b" id="analyticsBody">
						<!-- Analytics Dashboard Controls -->
						<div class="config-footer-row" style="margin-bottom: 15px;">
							<select class="form-select" id="analytics-date-range-selector" aria-label="Select date range">
								<option value="last_7_days">Last 7 Days</option>
								<option value="last_30_days" selected>Last 30 Days</option>
								<option value="last_90_days">Last 90 Days</option>
								<option value="this_month">This Month</option>
								<option value="last_month">Last Month</option>
								<option value="this_year">This Year</option>
							</select>
							<button type="button" class="btn btn-sm btn-secondary" onclick="exportAnalyticsDashboard()" aria-label="Export analytics report">
								Export Report
							</button>
						</div>

						<!-- KPI Cards -->
						<div class="kpi-grid">
							<!-- Revenue Card -->
							<div class="card kpi-card">
								<div class="card-body">
									<div class="kpi-header">
										<span class="kpi-label">Total Revenue</span>
										<span class="kpi-trend kpi-trend-flat" id="revenue-trend">-</span>
									</div>
									<div class="kpi-value" id="kpi-revenue">$0.00</div>
									<div class="kpi-footer">
										<div class="kpi-progress">
											<div class="kpi-progress-bar" id="revenue-progress" style="width: 0%"></div>
										</div>
										<span class="kpi-target" id="revenue-target">Target: $20,000</span>
									</div>
								</div>
							</div>

							<!-- Quotes Card -->
							<div class="card kpi-card">
								<div class="card-body">
									<div class="kpi-header">
										<span class="kpi-label">Quotes Generated</span>
										<span class="kpi-trend kpi-trend-flat" id="quotes-trend">-</span>
									</div>
									<div class="kpi-value" id="kpi-quotes">0</div>
									<div class="kpi-footer">
										<div class="kpi-progress">
											<div class="kpi-progress-bar" id="quotes-progress" style="width: 0%"></div>
										</div>
										<span class="kpi-target" id="quotes-target">Target: 30</span>
									</div>
								</div>
							</div>

							<!-- Conversion Rate Card -->
							<div class="card kpi-card">
								<div class="card-body">
									<div class="kpi-header">
										<span class="kpi-label">Conversion Rate</span>
										<span class="kpi-trend kpi-trend-flat" id="conversion-trend">-</span>
									</div>
									<div class="kpi-value" id="kpi-conversion">0%</div>
									<div class="kpi-footer">
										<div class="kpi-progress">
											<div class="kpi-progress-bar" id="conversion-progress" style="width: 0%"></div>
										</div>
										<span class="kpi-target" id="conversion-target">Target: 35%</span>
									</div>
								</div>
							</div>

							<!-- Avg Quote Value Card -->
							<div class="card kpi-card">
								<div class="card-body">
									<div class="kpi-header">
										<span class="kpi-label">Avg Quote Value</span>
										<span class="kpi-trend kpi-trend-flat" id="avg-value-trend">-</span>
									</div>
									<div class="kpi-value" id="kpi-avg-value">$0.00</div>
									<div class="kpi-footer">
										<div class="kpi-progress">
											<div class="kpi-progress-bar" id="avg-value-progress" style="width: 0%"></div>
										</div>
										<span class="kpi-target" id="avg-value-target">Target: $850</span>
									</div>
								</div>
							</div>
						</div>

						<!-- Revenue Trend Chart -->
						<div class="card" style="margin-top: 1.5rem;">
							<div class="card-header">
								<h3 class="card-title">Revenue Trend</h3>
								<div class="card-actions">
									<select class="form-select-sm" id="revenue-chart-grouping" aria-label="Select chart grouping">
										<option value="day">Daily</option>
										<option value="week">Weekly</option>
										<option value="month">Monthly</option>
									</select>
								</div>
							</div>
							<div class="card-body">
								<canvas id="revenue-trend-chart" height="80" aria-label="Revenue trend chart"></canvas>
							</div>
						</div>

						<!-- Two Column Layout -->
						<div class="analytics-grid">
							<!-- Conversion Funnel -->
							<div class="card">
								<div class="card-header">
									<h3 class="card-title">Conversion Funnel</h3>
								</div>
								<div class="card-body">
									<canvas id="conversion-funnel-chart" height="120" aria-label="Conversion funnel chart"></canvas>
								</div>
							</div>

							<!-- Service Breakdown -->
							<div class="card">
								<div class="card-header">
									<h3 class="card-title">Revenue by Service</h3>
								</div>
								<div class="card-body">
									<canvas id="service-breakdown-chart" height="120" aria-label="Service breakdown chart"></canvas>
								</div>
							</div>
						</div>

						<!-- Detailed Metrics Tables -->
						<div class="card" style="margin-top: 1.5rem;">
							<div class="card-header">
								<h3 class="card-title">Detailed Metrics</h3>
							</div>
							<div class="card-body">
								<div class="metrics-tabs">
									<button class="tab-btn active" onclick="showAnalyticsMetricsTab('financial')" aria-label="Financial metrics">Financial</button>
									<button class="tab-btn" onclick="showAnalyticsMetricsTab('sales')" aria-label="Sales metrics">Sales</button>
									<button class="tab-btn" onclick="showAnalyticsMetricsTab('operations')" aria-label="Operations metrics">Operations</button>
									<button class="tab-btn" onclick="showAnalyticsMetricsTab('customers')" aria-label="Customer metrics">Customers</button>
								</div>

								<div class="metrics-content">
									<div id="metrics-financial" class="metrics-tab-content active">
										<table class="metrics-table">
											<thead>
												<tr>
													<th>Metric</th>
													<th>Current</th>
													<th>Target</th>
													<th>Change</th>
												</tr>
											</thead>
											<tbody id="financial-metrics-body">
												<!-- Populated by JavaScript -->
											</tbody>
										</table>
									</div>

									<div id="metrics-sales" class="metrics-tab-content">
										<table class="metrics-table">
											<thead>
												<tr>
													<th>Metric</th>
													<th>Current</th>
													<th>Target</th>
													<th>Change</th>
												</tr>
											</thead>
											<tbody id="sales-metrics-body">
												<!-- Populated by JavaScript -->
											</tbody>
										</table>
									</div>

									<div id="metrics-operations" class="metrics-tab-content">
										<table class="metrics-table">
											<thead>
												<tr>
													<th>Metric</th>
													<th>Current</th>
													<th>Target</th>
													<th>Change</th>
												</tr>
											</thead>
											<tbody id="operations-metrics-body">
												<!-- Populated by JavaScript -->
											</tbody>
										</table>
									</div>

									<div id="metrics-customers" class="metrics-tab-content">
										<table class="metrics-table">
											<thead>
												<tr>
													<th>Metric</th>
													<th>Current</th>
													<th>Target</th>
													<th>Change</th>
												</tr>
											</thead>
											<tbody id="customers-metrics-body">
												<!-- Populated by JavaScript -->
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
                                </section>
                        </div>
                </section>
        </main>
	</div> <!-- /.app -->

	<!-- TASK DASHBOARD PAGE (Hidden by default) -->
	<div class="page" id="page-tasks" style="display: none;">
		<div class="container">
			<!-- Header -->
			<div class="page-header">
				<h1>Tasks & Follow-ups</h1>
				<div class="page-actions">
					<button class="btn btn-tertiary btn-sm" onclick="if(window.HelpSystem){HelpSystem.showHelpCenter();}else{alert('Help system loading...');}" aria-label="Show help" title="Help & Documentation">
						‚ùì Help
					</button>
					<button class="btn btn-primary btn-sm" onclick="showNewTaskModal()" aria-label="Create new task">
						+ New Task
					</button>
				</div>
			</div>

			<!-- Task Summary Cards -->
			<div class="task-summary-grid">
				<div class="card card-clickable" onclick="filterTasks('today')" role="button" tabindex="0" aria-label="View tasks due today">
					<div class="card-body">
						<div class="task-summary-label">Due Today</div>
						<div class="task-summary-value" id="tasks-today">0</div>
					</div>
				</div>

				<div class="card card-clickable" onclick="filterTasks('overdue')" role="button" tabindex="0" aria-label="View overdue tasks">
					<div class="card-body">
						<div class="task-summary-label">Overdue</div>
						<div class="task-summary-value task-overdue" id="tasks-overdue">0</div>
					</div>
				</div>

				<div class="card card-clickable" onclick="filterTasks('urgent')" role="button" tabindex="0" aria-label="View urgent tasks">
					<div class="card-body">
						<div class="task-summary-label">Urgent</div>
						<div class="task-summary-value task-urgent" id="tasks-urgent">0</div>
					</div>
				</div>

				<div class="card card-clickable" onclick="filterTasks('pending')" role="button" tabindex="0" aria-label="View pending tasks">
					<div class="card-body">
						<div class="task-summary-label">Pending</div>
						<div class="task-summary-value" id="tasks-pending">0</div>
					</div>
				</div>
			</div>

			<!-- Task Filters -->
			<div class="card" style="margin-bottom: 1.5rem;">
				<div class="card-body">
					<div class="task-filters">
						<select class="form-select" id="task-status-filter" aria-label="Filter by status">
							<option value="all">All Status</option>
							<option value="pending">Pending</option>
							<option value="in-progress">In Progress</option>
							<option value="overdue">Overdue</option>
							<option value="completed">Completed</option>
						</select>

						<select class="form-select" id="task-priority-filter" aria-label="Filter by priority">
							<option value="all">All Priorities</option>
							<option value="urgent">Urgent</option>
							<option value="high">High</option>
							<option value="normal">Normal</option>
							<option value="low">Low</option>
						</select>

						<select class="form-select" id="task-type-filter" aria-label="Filter by type">
							<option value="all">All Types</option>
							<option value="follow-up">Follow-up</option>
							<option value="phone-call">Phone Call</option>
							<option value="email">Email</option>
							<option value="sms">SMS</option>
						</select>
					</div>
				</div>
			</div>

			<!-- Task List -->
			<div id="task-list">
				<!-- Populated by JavaScript -->
			</div>

			<!-- Empty State -->
			<div id="tasks-empty-state" class="empty-state" style="display: none;">
				<svg class="empty-state-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
				</svg>
				<h3 class="empty-state-title">No Tasks</h3>
				<p class="empty-state-message">All caught up! No pending tasks at the moment.</p>
			</div>
		</div>
	</div>

	<!-- CUSTOMER DIRECTORY PAGE (Hidden by default) -->
	<div class="page" id="page-customers" style="display: none;">
		<div class="container">
			<!-- Header -->
			<div class="page-header">
				<h1>Customer Directory</h1>
				<div style="display: flex; gap: 0.5rem;">
					<button class="btn btn-tertiary btn-sm" onclick="backToQuotes()" aria-label="Back to quotes">
						‚Üê Back to Quotes
					</button>
					<button class="btn btn-tertiary btn-sm" onclick="if(window.HelpSystem){HelpSystem.showHelpCenter();}else{alert('Help system loading...');}" aria-label="Show help" title="Help & Documentation">
						‚ùì Help
					</button>
					<button class="btn btn-primary btn-sm" onclick="openAddCustomerModal()" aria-label="Add new customer">
						+ Add Customer
					</button>
				</div>
			</div>

			<!-- Search and Filters -->
			<div class="card" style="margin-bottom: 1.5rem;">
				<div class="card-body">
					<div style="display: flex; gap: 1rem; flex-wrap: wrap;">
						<input
							type="text"
							id="customer-search-input"
							class="form-input"
							placeholder="Search customers by name, email, phone, or location..."
							style="flex: 1; min-width: 250px;"
							aria-label="Search customers"
						/>
						<select class="form-select" id="customer-sort-select" aria-label="Sort customers" style="width: 200px;">
							<option value="name-asc">Name (A-Z)</option>
							<option value="name-desc">Name (Z-A)</option>
							<option value="recent">Recently Added</option>
							<option value="oldest">Oldest First</option>
							<option value="most-quotes">Most Quotes</option>
							<option value="highest-revenue">Highest Revenue</option>
						</select>
					</div>
				</div>
			</div>

			<!-- Customer Stats Summary -->
			<div class="task-summary-grid" style="margin-bottom: 1.5rem;">
				<div class="card">
					<div class="card-body">
						<div class="task-summary-label">Total Customers</div>
						<div class="task-summary-value" id="total-customers">0</div>
					</div>
				</div>

				<div class="card">
					<div class="card-body">
						<div class="task-summary-label">Total Quotes</div>
						<div class="task-summary-value" id="total-customer-quotes">0</div>
					</div>
				</div>

				<div class="card">
					<div class="card-body">
						<div class="task-summary-label">Total Revenue</div>
						<div class="task-summary-value" id="total-customer-revenue">$0.00</div>
					</div>
				</div>

				<div class="card">
					<div class="card-body">
						<div class="task-summary-label">Avg. Quote Value</div>
						<div class="task-summary-value" id="avg-quote-value">$0.00</div>
					</div>
				</div>
			</div>

			<!-- Customer List -->
			<div id="customer-list">
				<!-- Populated by JavaScript -->
			</div>

			<!-- Empty State -->
			<div id="customers-empty-state" class="empty-state" style="display: none;">
				<svg class="empty-state-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
				</svg>
				<h3 class="empty-state-title">No Customers Yet</h3>
				<p class="empty-state-message">Get started by adding your first customer.</p>
				<button class="btn btn-primary" onclick="openAddCustomerModal()" style="margin-top: 1rem;">
					+ Add Your First Customer
				</button>
			</div>
		</div>
	</div>

	<!-- WIZARD OVERLAY -->
	<div id="wizardOverlay" class="wizard-overlay">
		<div class="wizard-dialog">
			<div class="wizard-header">
				<h2 id="wizardTitle">Wizard</h2>
				<button id="wizardCloseBtn" type="button" class="wizard-close">√ó</button>
			</div>
			<div id="wizardContent" class="wizard-content">
				<!-- Filled dynamically by wizard.js -->
			</div>
		</div>
	</div>

	<!-- WEBHOOK SETTINGS MODAL -->
	<div id="webhookSettingsModal" class="wizard-overlay" style="display: none;">
		<div class="wizard-dialog" style="max-width: 800px;">
			<div class="wizard-header">
				<h2>Webhook Settings</h2>
				<button id="webhookSettingsCloseBtn" type="button" class="wizard-close" onclick="closeWebhookSettings()">√ó</button>
			</div>
			<div class="wizard-content">
				<!-- Sync Status Card -->
				<div class="card" style="margin-bottom: 1.5rem;">
					<div class="card-header">
						<h3 class="card-title">Sync Status</h3>
					</div>
					<div class="card-body">
						<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
							<div>
								<div style="color: #6b7280; font-size: 0.875rem; margin-bottom: 0.25rem;">Status</div>
								<div id="sync-status" style="font-weight: 500;">
									<span class="status-dot status-dot-neutral"></span> Disabled
								</div>
							</div>
							<div>
								<div style="color: #6b7280; font-size: 0.875rem; margin-bottom: 0.25rem;">Last Sync</div>
								<div id="last-sync-time" style="font-weight: 500;">Never</div>
							</div>
							<div>
								<div style="color: #6b7280; font-size: 0.875rem; margin-bottom: 0.25rem;">Pending Events</div>
								<div id="pending-events" style="font-weight: 500;">0</div>
							</div>
							<div>
								<button class="btn btn-primary btn-block" onclick="triggerManualSync()" style="margin-top: 1.25rem;">
									Sync Now
								</button>
							</div>
						</div>
					</div>
				</div>

				<!-- Webhook Configuration -->
				<div class="card" style="margin-bottom: 1.5rem;">
					<div class="card-header">
						<h3 class="card-title">Webhook Configuration</h3>
					</div>
					<div class="card-body">
						<div class="form-group">
							<label class="form-label" for="webhook-url">Webhook URL</label>
							<input
								type="url"
								class="form-input"
								id="webhook-url"
								placeholder="https://your-worker.workers.dev"
							>
							<span class="form-hint">Your Cloudflare Worker or backend webhook endpoint</span>
						</div>

						<div class="form-group">
							<label class="form-label" for="webhook-secret">Webhook Secret</label>
							<input
								type="password"
								class="form-input"
								id="webhook-secret"
								placeholder="Enter webhook secret"
							>
							<span class="form-hint">Secret key for webhook signature verification</span>
						</div>

						<div class="form-group">
							<label class="form-checkbox-wrapper">
								<input
									type="checkbox"
									class="form-checkbox"
									id="webhook-enabled"
									checked
								>
								<span>Enable real-time sync</span>
							</label>
						</div>

						<div class="form-group">
							<label class="form-checkbox-wrapper">
								<input
									type="checkbox"
									class="form-checkbox"
									id="bidirectional-sync"
									checked
								>
								<span>Bidirectional sync (sync changes both ways)</span>
							</label>
						</div>

						<div class="form-group">
							<label class="form-label" for="conflict-resolution">Conflict Resolution</label>
							<select class="form-select" id="conflict-resolution">
								<option value="timestamp">Most recent wins (recommended)</option>
								<option value="ghl-wins">GoHighLevel always wins</option>
								<option value="local-wins">Local always wins</option>
								<option value="manual">Manual resolution</option>
							</select>
						</div>

						<button class="btn btn-primary" onclick="saveWebhookSettings()">
							Save Settings
						</button>
						<button class="btn btn-secondary" onclick="testWebhookEndpoint()" style="margin-left: 0.5rem;">
							Test Endpoint
						</button>
					</div>
				</div>

				<!-- Event Subscriptions -->
				<div class="card" style="margin-bottom: 1.5rem;">
					<div class="card-header">
						<h3 class="card-title">Event Subscriptions</h3>
					</div>
					<div class="card-body">
						<p class="form-hint" style="margin-bottom: 1rem;">
							Select which events should trigger sync updates
						</p>

						<div class="event-subscriptions-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.75rem;">
							<label class="form-checkbox-wrapper">
								<input type="checkbox" class="form-checkbox" value="ContactUpdate" checked>
								<span>Contact Updates</span>
							</label>

							<label class="form-checkbox-wrapper">
								<input type="checkbox" class="form-checkbox" value="OpportunityUpdate" checked>
								<span>Opportunity Updates</span>
							</label>

							<label class="form-checkbox-wrapper">
								<input type="checkbox" class="form-checkbox" value="TaskUpdate" checked>
								<span>Task Updates</span>
							</label>

							<label class="form-checkbox-wrapper">
								<input type="checkbox" class="form-checkbox" value="NoteCreate" checked>
								<span>New Notes</span>
							</label>

							<label class="form-checkbox-wrapper">
								<input type="checkbox" class="form-checkbox" value="InboundMessage">
								<span>Inbound Messages (SMS/Email)</span>
							</label>

							<label class="form-checkbox-wrapper">
								<input type="checkbox" class="form-checkbox" value="AppointmentUpdate">
								<span>Appointment Updates</span>
							</label>
						</div>
					</div>
				</div>

				<!-- GHL Registration -->
				<div class="card">
					<div class="card-header">
						<h3 class="card-title">GoHighLevel Registration</h3>
					</div>
					<div class="card-body">
						<p class="form-hint" style="margin-bottom: 1rem;">
							Register your webhook endpoint with GoHighLevel to start receiving real-time updates.
						</p>

						<div style="display: flex; gap: 0.5rem;">
							<button class="btn btn-primary" onclick="registerWebhookWithGHL()">
								Register Webhook
							</button>
							<button class="btn btn-tertiary" onclick="unregisterWebhookFromGHL()">
								Unregister
							</button>
							<button class="btn btn-secondary" onclick="viewEventQueue()">
								View Queue
							</button>
							<button class="btn btn-tertiary" onclick="clearEventQueue()">
								Clear Queue
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>


	<!-- TEST RUNNER MODAL -->
	<div id="testRunnerModal" class="modal-overlay" style="display: none;">
		<div class="modal" style="max-width: 1200px;">
			<div class="modal-header">
				<h2 class="modal-title">üß™ Test & QA Suite</h2>
				<button class="modal-close" onclick="closeTestRunner()" aria-label="Close test runner">√ó</button>
			</div>

				<div class="modal-body">
					<!-- Test Actions -->
					<div class="test-actions">
						<button id="run-all-tests-btn" class="btn btn-primary" onclick="TestRunner.runAllTests()">
							Run All Tests
						</button>
						<button id="run-unit-tests-btn" class="btn btn-secondary" onclick="TestRunner.runUnitTests()">
							Unit Tests
						</button>
						<button id="run-integration-tests-btn" class="btn btn-secondary" onclick="TestRunner.runIntegrationTests()">
							Integration Tests
						</button>
						<button id="run-performance-tests-btn" class="btn btn-secondary" onclick="TestRunner.runPerformanceTests()">
							Performance Tests
						</button>
						<button id="clear-console-btn" class="btn btn-tertiary" onclick="TestRunner.clearTestConsole()">
							Clear Console
						</button>
						<button id="download-results-btn" class="btn btn-tertiary" onclick="TestRunner.downloadTestResults()">
							Download Results
						</button>
					</div>

					<!-- Test Results Summary -->
					<div class="card" id="test-results-summary" style="display: none; margin-bottom: 1.5rem;">
						<div class="card-body">
							<div class="test-results-grid">
								<div class="test-result-item">
									<div class="test-result-label">Total Tests</div>
									<div class="test-result-value" id="test-total">0</div>
								</div>
								<div class="test-result-item test-result-success">
									<div class="test-result-label">Passed</div>
									<div class="test-result-value" id="test-passed">0</div>
								</div>
								<div class="test-result-item test-result-danger">
									<div class="test-result-label">Failed</div>
									<div class="test-result-value" id="test-failed">0</div>
								</div>
								<div class="test-result-item test-result-neutral">
									<div class="test-result-label">Skipped</div>
									<div class="test-result-value" id="test-skipped">0</div>
								</div>
							</div>
							<div class="test-pass-rate">
								<div class="test-pass-rate-label">Pass Rate:</div>
								<div class="test-pass-rate-value" id="test-pass-rate">0%</div>
							</div>
						</div>
					</div>

					<!-- Test Console -->
					<div class="card" style="margin-bottom: 1.5rem;">
						<div class="card-header">
							<h3 class="card-title">Test Console</h3>
						</div>
						<div class="card-body">
							<pre id="test-console" class="test-console"></pre>
						</div>
					</div>

					<!-- Tabs for Checklist and Production Readiness -->
					<div class="tabs" style="margin-bottom: 1rem;">
						<button class="tab-btn active" onclick="showTestTab('checklist')">Manual Checklist</button>
						<button class="tab-btn" onclick="showTestTab('readiness')">Production Readiness</button>
					</div>

					<!-- Manual Test Checklist Tab -->
					<div id="test-tab-checklist" class="tab-content">
						<div class="card">
							<div class="card-header">
								<h3 class="card-title">Manual Test Checklist</h3>
								<div class="card-actions">
									<button id="export-checklist-btn" class="btn btn-tertiary btn-sm" onclick="TestChecklist.exportChecklistResults()">
										Export
									</button>
									<button id="reset-checklist-btn" class="btn btn-tertiary btn-sm" onclick="TestChecklist.resetChecklist()">
										Reset
									</button>
								</div>
							</div>
							<div class="card-body">
								<!-- Progress Bar -->
								<div class="checklist-progress">
									<div class="checklist-progress-label">
										<span>Progress</span>
										<span id="checklist-progress-text">0 / 0 (0%)</span>
									</div>
									<div class="checklist-progress-bar-container">
										<div id="checklist-progress-bar" class="checklist-progress-bar" style="width: 0%;" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
									</div>
								</div>

								<!-- Checklist Items -->
								<div id="manual-test-checklist">
									<!-- Populated by JavaScript -->
								</div>
							</div>
						</div>
					</div>

					<!-- Production Readiness Tab -->
					<div id="test-tab-readiness" class="tab-content" style="display: none;">
						<div class="card">
							<div class="card-header">
								<h3 class="card-title">Production Readiness Check</h3>
								<div class="card-actions">
									<button class="btn btn-primary btn-sm" onclick="runProductionReadinessCheck()">
										Run Check
									</button>
									<button class="btn btn-tertiary btn-sm" onclick="ProductionReadiness.exportReport()">
										Export Report
									</button>
								</div>
							</div>
							<div class="card-body">
								<p class="form-hint">
									Comprehensive production deployment readiness validation
								</p>
								<div id="production-readiness-results">
									<p style="text-align: center; color: var(--color-neutral-500); padding: 2rem;">
										Click "Run Check" to start the production readiness validation
									</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	<!-- JOBS LIST PAGE (Hidden by default) -->
	<div class="page" id="page-jobs" style="display: none;">
		<div class="container">
			<div class="page-header">
				<h1>üìã Jobs</h1>
				<div class="page-actions">
					<button class="btn btn-tertiary" onclick="if(window.HelpSystem){HelpSystem.showHelpCenter();}else{alert('Help system loading...');}" aria-label="Show help" title="Help & Documentation">
						‚ùì Help
					</button>
					<button class="btn btn-primary" onclick="showCreateJobDialog()">
						‚ûï Create Job
					</button>
				</div>
			</div>

			<!-- Job Filters -->
			<div class="card">
				<div class="card-body">
					<div class="filter-tabs">
						<button class="filter-tab active" onclick="JobTrackingUI.filterJobs('all')">All</button>
						<button class="filter-tab" onclick="JobTrackingUI.filterJobs('scheduled')">Scheduled</button>
						<button class="filter-tab" onclick="JobTrackingUI.filterJobs('in-progress')">In Progress</button>
						<button class="filter-tab" onclick="JobTrackingUI.filterJobs('completed')">Completed</button>
						<button class="filter-tab" onclick="JobTrackingUI.filterJobs('invoiced')">Invoiced</button>
					</div>
				</div>
			</div>

			<!-- Jobs Summary Cards -->
			<div class="stats-grid">
				<div class="stat-card">
					<div class="stat-label">Scheduled</div>
					<div class="stat-value" id="jobs-count-scheduled">0</div>
				</div>
				<div class="stat-card">
					<div class="stat-label">In Progress</div>
					<div class="stat-value" id="jobs-count-in-progress">0</div>
				</div>
				<div class="stat-card">
					<div class="stat-label">Completed</div>
					<div class="stat-value" id="jobs-count-completed">0</div>
				</div>
				<div class="stat-card">
					<div class="stat-label">Total Revenue</div>
					<div class="stat-value" id="jobs-total-revenue">$0</div>
				</div>
			</div>

			<!-- Jobs List -->
			<div class="card">
				<div class="card-header">
					<h3 class="card-title">All Jobs</h3>
				</div>
				<div class="card-body">
					<div id="jobs-list-container">
						<p class="text-muted">No jobs found. Create a job from a quote to get started.</p>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Create Job Modal -->
	<div class="modal-overlay" id="create-job-modal" style="display: none;">
		<div class="modal">
			<div class="modal-header">
				<h2 class="modal-title">Create Job from Quote</h2>
				<button class="modal-close" onclick="closeCreateJobDialog()" aria-label="Close">&times;</button>
			</div>
			<div class="modal-body">
				<div class="form-group">
					<label class="form-label form-label-required" for="create-job-quote-select">Select Quote</label>
					<select id="create-job-quote-select" class="form-select" aria-required="true">
						<option value="">-- Select a quote --</option>
					</select>
				</div>
				<div class="form-group">
					<label class="form-label form-label-required" for="create-job-scheduled-date">Scheduled Date</label>
					<input type="date" id="create-job-scheduled-date" class="form-input" aria-required="true" />
				</div>
				<div class="form-group">
					<label class="form-label" for="create-job-scheduled-time">Scheduled Time</label>
					<input type="time" id="create-job-scheduled-time" class="form-input" value="09:00" />
				</div>
			</div>
			<div class="modal-footer">
				<button class="btn btn-secondary" onclick="closeCreateJobDialog()">Cancel</button>
				<button class="btn btn-primary" onclick="createJobFromQuote()">Create Job</button>
			</div>
		</div>
	</div>

	<!-- ACTIVE JOB PAGE (Hidden by default) -->
	<div class="page" id="page-active-job" style="display: none;">
		<div class="container">
			<div class="page-header">
				<button class="btn btn-secondary btn-sm" onclick="navigateTo('jobs')">‚Üê Jobs</button>
				<h1 id="job-title">Job #JOB-0001</h1>
				<div class="page-actions">
					<button class="btn btn-tertiary btn-sm" onclick="if(window.HelpSystem){HelpSystem.showHelpCenter();}else{alert('Help system loading...');}" aria-label="Show help" title="Help & Documentation">
						‚ùì Help
					</button>
					<button class="btn btn-danger" id="complete-job-btn" onclick="JobTrackingUI.showCompleteJobDialog()">
						‚úì Complete Job
					</button>
				</div>
			</div>

			<!-- Job Timer -->
			<div class="card job-timer-card">
				<div class="timer-display">
					<div class="timer-value" id="job-timer">00:00:00</div>
					<div class="timer-label">Time Elapsed</div>
				</div>
				<div class="timer-controls">
					<button class="btn btn-primary" id="start-job-btn" onclick="JobTrackingUI.startJobTracking()">
						‚ñ∂ Start Job
					</button>
					<button class="btn btn-secondary hidden" id="pause-job-btn" onclick="JobTrackingUI.pauseJobTracking()">
						‚è∏ Pause
					</button>
				</div>
			</div>

			<!-- Quick Actions -->
			<div class="quick-actions-grid">
				<button class="quick-action-btn" onclick="takeBeforePhoto()">
					<span class="quick-action-icon">üì∑</span>
					<span class="quick-action-label">Before Photo</span>
				</button>
				<button class="quick-action-btn" onclick="takeAfterPhoto()">
					<span class="quick-action-icon">üì∏</span>
					<span class="quick-action-label">After Photo</span>
				</button>
				<button class="quick-action-btn" onclick="recordJobIssue()">
					<span class="quick-action-icon">‚ö†Ô∏è</span>
					<span class="quick-action-label">Report Issue</span>
				</button>
				<button class="quick-action-btn" onclick="addJobNote()">
					<span class="quick-action-icon">üìù</span>
					<span class="quick-action-label">Add Note</span>
				</button>
				<button class="quick-action-btn" onclick="addScopeChange()">
					<span class="quick-action-icon">‚ûï</span>
					<span class="quick-action-label">Extra Work</span>
				</button>
				<button class="quick-action-btn" onclick="updateDifficulty()">
					<span class="quick-action-icon">üéØ</span>
					<span class="quick-action-label">Difficulty</span>
				</button>
			</div>

			<!-- Work Items Tracker -->
			<div class="card">
				<div class="card-header">
					<h3 class="card-title">Work Items</h3>
				</div>
				<div class="card-body">
					<div id="work-items-list">
						<!-- Populated by JavaScript -->
					</div>
				</div>
			</div>

			<!-- Photos Section -->
			<div class="card">
				<div class="card-header">
					<h3 class="card-title">Job Photos</h3>
					<span class="badge" id="photo-count">0</span>
				</div>
				<div class="card-body">
					<div class="photo-tabs">
						<button class="photo-tab active" onclick="JobTrackingUI.showPhotoCategory('before')">Before</button>
						<button class="photo-tab" onclick="JobTrackingUI.showPhotoCategory('after')">After</button>
						<button class="photo-tab" onclick="JobTrackingUI.showPhotoCategory('issues')">Issues</button>
					</div>
					<div id="photos-grid">
						<!-- Photos appear here -->
					</div>
				</div>
			</div>

			<!-- Issues & Notes -->
			<div class="card">
				<div class="card-header">
					<h3 class="card-title">Issues & Notes</h3>
				</div>
				<div class="card-body">
					<div id="issues-notes-list">
						<!-- Issues and notes appear here -->
					</div>
				</div>
			</div>

			<!-- Price Adjustment -->
			<div class="card">
				<div class="card-header">
					<h3 class="card-title">Pricing</h3>
				</div>
				<div class="card-body">
					<div class="pricing-comparison">
						<div class="pricing-col">
							<div class="pricing-label">Original Quote</div>
							<div class="pricing-value" id="original-total">$0.00</div>
						</div>
						<div class="pricing-col">
							<div class="pricing-label">Actual Cost</div>
							<div class="pricing-value" id="actual-total">$0.00</div>
						</div>
						<div class="pricing-col">
							<div class="pricing-label">Difference</div>
							<div class="pricing-value pricing-difference" id="price-difference">$0.00</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- PRICING INSIGHTS PAGE (Hidden by default) -->
	<div class="page" id="page-pricing-insights" style="display: none;">
		<div class="container">
			<div class="page-header">
				<h1>Pricing Insights</h1>
				<button class="btn btn-tertiary btn-sm" onclick="if(window.HelpSystem){HelpSystem.showHelpCenter();}else{alert('Help system loading...');}" aria-label="Show help" title="Help & Documentation">
					‚ùì Help
				</button>
				<p class="subtitle">Learn from completed jobs to improve accuracy</p>
			</div>

			<!-- Accuracy Overview -->
			<div class="card">
				<div class="card-header">
					<h3 class="card-title">Pricing Accuracy</h3>
				</div>
				<div class="card-body">
					<div class="accuracy-gauge">
						<div class="gauge-value" id="accuracy-percentage">0%</div>
						<div class="gauge-label">Accurate</div>
					</div>

					<div class="accuracy-stats">
						<div class="stat">
							<div class="stat-label">Jobs Analyzed</div>
							<div class="stat-value" id="jobs-analyzed">0</div>
						</div>
						<div class="stat">
							<div class="stat-label">Underquotes</div>
							<div class="stat-value text-danger" id="underquotes-count">0</div>
						</div>
						<div class="stat">
							<div class="stat-label">Overquotes</div>
							<div class="stat-value text-warning" id="overquotes-count">0</div>
						</div>
						<div class="stat">
							<div class="stat-label">Avg Variance</div>
							<div class="stat-value" id="avg-variance">0%</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Performance Metrics -->
			<div class="card">
				<div class="card-header">
					<h3 class="card-title">Performance Metrics</h3>
				</div>
				<div class="card-body">
					<div class="metrics-grid">
						<div class="metric-item">
							<div class="metric-label">Avg Time Per Window</div>
							<div class="metric-value" id="avg-time-window">0 min</div>
						</div>
						<div class="metric-item">
							<div class="metric-label">Avg Time Per SQM</div>
							<div class="metric-value" id="avg-time-sqm">0 min</div>
						</div>
						<div class="metric-item">
							<div class="metric-label">Avg Job Duration</div>
							<div class="metric-value" id="avg-job-duration">0 min</div>
						</div>
						<div class="metric-item">
							<div class="metric-label">Avg Job Value</div>
							<div class="metric-value" id="avg-job-value">$0</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Common Issues -->
			<div class="card">
				<div class="card-header">
					<h3 class="card-title">Common Issues</h3>
				</div>
				<div class="card-body">
					<div id="common-issues-list">
						<!-- Populated by JavaScript -->
					</div>
				</div>
			</div>

			<!-- Recommendations -->
			<div class="card">
				<div class="card-header">
					<h3 class="card-title">Recommendations</h3>
				</div>
				<div class="card-body">
					<div id="recommendations-list">
						<!-- Populated by JavaScript -->
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Complete Job Modal -->
	<div class="modal-overlay" id="complete-job-modal" style="display: none;">
		<div class="modal">
			<div class="modal-header">
				<h2 class="modal-title">Complete Job</h2>
				<button class="modal-close" onclick="JobTrackingUI.closeCompleteJobDialog()" aria-label="Close">&times;</button>
			</div>
			<div class="modal-body">
				<div class="form-group">
					<label class="form-label">Client Rating</label>
					<div class="rating-stars" id="client-rating">
						<span class="star" data-rating="1" onclick="JobTrackingUI.setRating(1)">‚òÜ</span>
						<span class="star" data-rating="2" onclick="JobTrackingUI.setRating(2)">‚òÜ</span>
						<span class="star" data-rating="3" onclick="JobTrackingUI.setRating(3)">‚òÜ</span>
						<span class="star" data-rating="4" onclick="JobTrackingUI.setRating(4)">‚òÜ</span>
						<span class="star" data-rating="5" onclick="JobTrackingUI.setRating(5)">‚òÜ</span>
					</div>
				</div>

				<div class="form-group">
					<label class="form-label" for="client-feedback">Client Feedback</label>
					<textarea class="form-textarea" id="client-feedback" rows="3" placeholder="Any feedback from the client..."></textarea>
				</div>

				<div class="form-checkbox-wrapper">
					<input type="checkbox" id="photos-shown" class="form-checkbox">
					<label for="photos-shown">Showed before/after photos to client</label>
				</div>

				<div class="form-checkbox-wrapper">
					<input type="checkbox" id="warranty-issued" class="form-checkbox">
					<label for="warranty-issued">Issued service warranty</label>
				</div>

				<div class="form-checkbox-wrapper">
					<input type="checkbox" id="followup-required" class="form-checkbox">
					<label for="followup-required">Follow-up required</label>
				</div>
			</div>
			<div class="modal-footer">
				<button class="btn btn-secondary" onclick="JobTrackingUI.closeCompleteJobDialog()">Cancel</button>
				<button class="btn btn-primary" onclick="JobTrackingUI.finalizeJobCompletion()">Complete Job</button>
			</div>
		</div>
	</div>

	<!-- CONTRACTS PAGE (Hidden by default) -->
	<div class="page" id="page-contracts" style="display: none;">
		<div class="container">
			<!-- Header -->
			<div class="page-header">
				<button class="btn btn-secondary btn-sm" onclick="backToQuotes()">‚Üê Back</button>
				<h1>üìù Contract Management</h1>
				<div class="page-actions">
					<button class="btn btn-tertiary" onclick="if(window.HelpSystem){HelpSystem.showHelpCenter();}else{alert('Help system loading...');}" aria-label="Show help" title="Help & Documentation">
						‚ùì Help
					</button>
					<button class="btn btn-primary" onclick="openContractWizard()" aria-label="Create new contract">
						‚ûï New Contract
					</button>
					<button class="btn btn-secondary" onclick="exportContracts()" aria-label="Export contracts">
						üì§ Export
					</button>
				</div>
			</div>

			<!-- Summary Cards -->
			<div class="summary-cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
				<div class="card">
					<div class="card-body">
						<div class="summary-label">Active Contracts</div>
						<div class="summary-value" id="contract-count-active">0</div>
					</div>
				</div>
				<div class="card">
					<div class="card-body">
						<div class="summary-label">Monthly Recurring Revenue</div>
						<div class="summary-value" id="contract-mrr">$0.00</div>
					</div>
				</div>
				<div class="card">
					<div class="card-body">
						<div class="summary-label">Annual Recurring Revenue</div>
						<div class="summary-value" id="contract-arr">$0.00</div>
					</div>
				</div>
				<div class="card">
					<div class="card-body">
						<div class="summary-label">Total Contract Value</div>
						<div class="summary-value" id="contract-total-value">$0.00</div>
					</div>
				</div>
			</div>

			<!-- Filters -->
			<div class="card" style="margin-bottom: 1.5rem;">
				<div class="card-body">
					<div style="display: flex; gap: 1rem; flex-wrap: wrap;">
						<select id="contract-status-filter" class="form-select" style="flex: 1; min-width: 150px;" onchange="filterContracts()">
							<option value="">All Statuses</option>
							<option value="active">Active</option>
							<option value="draft">Draft</option>
							<option value="paused">Paused</option>
							<option value="cancelled">Cancelled</option>
							<option value="expired">Expired</option>
						</select>
						<select id="contract-type-filter" class="form-select" style="flex: 1; min-width: 150px;" onchange="filterContracts()">
							<option value="">All Types</option>
							<option value="residential">Residential</option>
							<option value="commercial">Commercial</option>
							<option value="strata">Strata</option>
						</select>
						<input type="text" id="contract-search" class="form-input" placeholder="Search contracts..." style="flex: 2; min-width: 200px;" oninput="filterContracts()">
					</div>
				</div>
			</div>

			<!-- Contracts List -->
			<div class="card">
				<div class="card-body">
					<div id="contracts-list">
						<p style="text-align: center; color: #6b7280; padding: 2rem;">
							No contracts found. Click "New Contract" to create your first contract.
						</p>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- ANALYTICS DASHBOARD PAGE (Hidden by default) -->
	<div class="page" id="page-analytics-dashboard" style="display: none;">
		<div class="container">
			<!-- Header -->
			<div class="page-header">
				<button class="btn btn-secondary btn-sm" onclick="backToQuotes()">‚Üê Back</button>
				<h1>üìä Analytics Dashboard</h1>
				<div class="page-actions">
					<button class="btn btn-tertiary" onclick="if(window.HelpSystem){HelpSystem.showHelpCenter();}else{alert('Help system loading...');}" aria-label="Show help" title="Help & Documentation">
						‚ùì Help
					</button>
					<select id="analytics-period" class="form-select" onchange="updateAnalyticsPeriod()" style="width: auto;">
						<option value="7">Last 7 Days</option>
						<option value="30" selected>Last 30 Days</option>
						<option value="90">Last 90 Days</option>
						<option value="365">Last Year</option>
						<option value="all">All Time</option>
					</select>
					<button class="btn btn-secondary" onclick="exportAnalytics()" aria-label="Export analytics">
						üì§ Export
					</button>
					<button class="btn btn-tertiary" onclick="refreshAnalytics()" aria-label="Refresh analytics">
						üîÑ Refresh
					</button>
				</div>
			</div>

			<!-- Key Metrics -->
			<div class="metrics-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
				<div class="card">
					<div class="card-body">
						<div class="metric-label">Total Revenue</div>
						<div class="metric-value" id="analytics-total-revenue">$0.00</div>
						<div class="metric-change" id="analytics-revenue-change">--</div>
					</div>
				</div>
				<div class="card">
					<div class="card-body">
						<div class="metric-label">Total Quotes</div>
						<div class="metric-value" id="analytics-total-quotes">0</div>
						<div class="metric-change" id="analytics-quotes-change">--</div>
					</div>
				</div>
				<div class="card">
					<div class="card-body">
						<div class="metric-label">Win Rate</div>
						<div class="metric-value" id="analytics-win-rate">0%</div>
						<div class="metric-change" id="analytics-winrate-change">--</div>
					</div>
				</div>
				<div class="card">
					<div class="card-body">
						<div class="metric-label">Avg Quote Value</div>
						<div class="metric-value" id="analytics-avg-quote">$0.00</div>
						<div class="metric-change" id="analytics-avgquote-change">--</div>
					</div>
				</div>
			</div>

			<!-- Charts -->
			<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem;">
				<!-- Revenue Chart -->
				<div class="card">
					<div class="card-header">
						<h3 class="card-title">Revenue Trend</h3>
					</div>
					<div class="card-body">
						<canvas id="analytics-revenue-chart" style="max-height: 300px;"></canvas>
					</div>
				</div>

				<!-- Service Mix Chart -->
				<div class="card">
					<div class="card-header">
						<h3 class="card-title">Service Mix</h3>
					</div>
					<div class="card-body">
						<canvas id="analytics-service-chart" style="max-height: 300px;"></canvas>
					</div>
				</div>

				<!-- Conversion Funnel -->
				<div class="card">
					<div class="card-header">
						<h3 class="card-title">Conversion Funnel</h3>
					</div>
					<div class="card-body">
						<canvas id="analytics-funnel-chart" style="max-height: 300px;"></canvas>
					</div>
				</div>

				<!-- Client Sources -->
				<div class="card">
					<div class="card-header">
						<h3 class="card-title">Client Sources</h3>
					</div>
					<div class="card-body">
						<canvas id="analytics-source-chart" style="max-height: 300px;"></canvas>
					</div>
				</div>
			</div>

			<!-- Detailed Analytics Table -->
			<div class="card" style="margin-top: 1.5rem;">
				<div class="card-header">
					<h3 class="card-title">Recent Activity</h3>
				</div>
				<div class="card-body">
					<div id="analytics-table">
						<p style="text-align: center; color: #6b7280; padding: 2rem;">
							Loading analytics data...
						</p>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- HELP SYSTEM PAGE (Hidden by default) -->
	<div class="page" id="page-help" style="display: none;">
		<div class="container">
			<!-- Header -->
			<div class="page-header">
				<button class="btn btn-secondary btn-sm" onclick="backToQuotes()">‚Üê Back</button>
				<h1>‚ùì Help & Documentation</h1>
				<div class="page-actions">
					<input type="text" id="help-search" class="form-input" placeholder="Search help..." style="width: 300px;" oninput="searchHelp()">
				</div>
			</div>

			<!-- Quick Links -->
			<div class="card" style="margin-bottom: 1.5rem;">
				<div class="card-header">
					<h3 class="card-title">Quick Links</h3>
				</div>
				<div class="card-body">
					<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
						<button class="btn btn-secondary" onclick="showHelpTopic('getting-started')">
							üöÄ Getting Started
						</button>
						<button class="btn btn-secondary" onclick="showHelpTopic('quotes')">
							üí∞ Creating Quotes
						</button>
						<button class="btn btn-secondary" onclick="showHelpTopic('invoices')">
							üßæ Invoicing
						</button>
						<button class="btn btn-secondary" onclick="showHelpTopic('contracts')">
							üìù Contracts
						</button>
						<button class="btn btn-secondary" onclick="showHelpTopic('analytics')">
							üìä Analytics
						</button>
						<button class="btn btn-secondary" onclick="showHelpTopic('shortcuts')">
							‚å®Ô∏è Keyboard Shortcuts
						</button>
					</div>
				</div>
			</div>

			<!-- Help Content -->
			<div class="card">
				<div class="card-body" id="help-content">
					<h2>Welcome to TicTacStick Help</h2>
					<p>Select a topic from the quick links above or use the search bar to find what you're looking for.</p>

					<h3>Popular Topics</h3>
					<ul>
						<li><a href="#" onclick="showHelpTopic('getting-started'); return false;">Getting Started with TicTacStick</a></li>
						<li><a href="#" onclick="showHelpTopic('quotes'); return false;">How to Create a Quote</a></li>
						<li><a href="#" onclick="showHelpTopic('invoices'); return false;">Converting Quotes to Invoices</a></li>
						<li><a href="#" onclick="showHelpTopic('contracts'); return false;">Managing Recurring Contracts</a></li>
						<li><a href="#" onclick="showHelpTopic('offline'); return false;">Working Offline</a></li>
						<li><a href="#" onclick="showHelpTopic('troubleshooting'); return false;">Troubleshooting Common Issues</a></li>
					</ul>

					<h3>Video Tutorials</h3>
					<p>Watch our video tutorials for step-by-step guidance:</p>
					<ul>
						<li>Creating Your First Quote (5 minutes)</li>
						<li>Advanced Pricing Strategies (8 minutes)</li>
						<li>Contract Management Walkthrough (10 minutes)</li>
						<li>Analytics Dashboard Tour (6 minutes)</li>
					</ul>

					<h3>Need More Help?</h3>
					<p>If you can't find what you're looking for, contact support:</p>
					<ul>
						<li>üìß Email: support@925pressureglass.com.au</li>
						<li>üìû Phone: 0400 000 000</li>
						<li>üí¨ Live Chat: Available Mon-Fri 9am-5pm AWST</li>
					</ul>
				</div>
			</div>
		</div>
	</div>

	<!-- SETTINGS PAGE (Hidden by default) -->
	<div class="page" id="page-settings" style="display: none;">
		<div class="container">
			<!-- Header -->
			<div class="page-header">
				<button class="btn btn-secondary btn-sm" onclick="backToQuotes()">‚Üê Back</button>
				<h1>‚öôÔ∏è Settings & Configuration</h1>
			</div>

			<!-- Backup & Restore Section -->
			<div class="card" style="margin-bottom: 1.5rem;">
				<div class="card-header">
					<h3 class="card-title">üíæ Backup & Restore</h3>
				</div>
				<div class="card-body">
					<p>Protect your data by creating regular backups. Export all your quotes, clients, invoices, contracts, and settings to a JSON file.</p>

					<div style="display: grid; gap: 1rem; margin-top: 1rem;">
						<!-- Backup Section -->
						<div style="display: flex; gap: 1rem; align-items: center; padding: 1rem; background: #f9fafb; border-radius: 0.5rem;">
							<div style="flex: 1;">
								<h4 style="margin: 0 0 0.5rem 0;">Export All Data</h4>
								<p style="margin: 0; color: #6b7280; font-size: 0.875rem;">
									Download a complete backup of all your data including quotes, clients, invoices, contracts, tasks, and settings.
								</p>
								<p style="margin: 0.5rem 0 0 0; color: #6b7280; font-size: 0.75rem;">
									Last backup: <span id="last-backup-date">Never</span>
								</p>
							</div>
							<button class="btn btn-primary" onclick="exportAllData()" aria-label="Export all data">
								üì§ Export All Data
							</button>
						</div>

						<!-- Restore Section -->
						<div style="display: flex; gap: 1rem; align-items: center; padding: 1rem; background: #fef3c7; border-radius: 0.5rem;">
							<div style="flex: 1;">
								<h4 style="margin: 0 0 0.5rem 0;">‚ö†Ô∏è Restore from Backup</h4>
								<p style="margin: 0; color: #92400e; font-size: 0.875rem;">
									<strong>Warning:</strong> Restoring will replace all current data. Make sure to export a backup first!
								</p>
							</div>
							<div style="display: flex; gap: 0.5rem;">
								<input type="file" id="backup-file-input" accept=".json" style="display: none;" onchange="importBackupFile(event)">
								<button class="btn btn-secondary" onclick="document.getElementById('backup-file-input').click()" aria-label="Import backup">
									üì• Import Backup
								</button>
							</div>
						</div>

						<!-- Auto-Backup Section -->
						<div style="display: flex; gap: 1rem; align-items: center; padding: 1rem; background: #f0fdf4; border-radius: 0.5rem;">
							<div style="flex: 1;">
								<h4 style="margin: 0 0 0.5rem 0;">üîÑ Automatic Backups</h4>
								<p style="margin: 0; color: #166534; font-size: 0.875rem;">
									Enable automatic backups every 24 hours. Backups are stored in LocalStorage.
								</p>
							</div>
							<label class="form-checkbox-wrapper">
								<input type="checkbox" id="auto-backup-enabled" class="form-checkbox" onchange="toggleAutoBackup()">
								<span>Enable Auto-Backup</span>
							</label>
						</div>
					</div>
				</div>
			</div>

			<!-- Storage Information -->
			<div class="card" style="margin-bottom: 1.5rem;">
				<div class="card-header">
					<h3 class="card-title">üíø Storage Information</h3>
				</div>
				<div class="card-body">
					<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
						<div>
							<div class="metric-label">Storage Used</div>
							<div class="metric-value" id="storage-used">0 MB</div>
						</div>
						<div>
							<div class="metric-label">Storage Quota</div>
							<div class="metric-value" id="storage-quota">5 MB</div>
						</div>
						<div>
							<div class="metric-label">Usage Percentage</div>
							<div class="metric-value" id="storage-percentage">0%</div>
						</div>
						<div>
							<button class="btn btn-secondary" onclick="refreshStorageInfo()" aria-label="Refresh storage info">
								üîÑ Refresh
							</button>
						</div>
					</div>
					<div style="margin-top: 1rem; padding: 1rem; background: #eff6ff; border-radius: 0.5rem; border-left: 4px solid #3b82f6;">
						<p style="margin: 0; color: #1e40af; font-size: 0.875rem;">
							<strong>Tip:</strong> If storage is full, export and delete old quotes or compress/remove photos to free up space.
						</p>
					</div>
				</div>
			</div>

			<!-- Application Information -->
			<div class="card" style="margin-bottom: 1.5rem;">
				<div class="card-header">
					<h3 class="card-title">‚ÑπÔ∏è Application Information</h3>
				</div>
				<div class="card-body">
					<table style="width: 100%;">
						<tr style="border-bottom: 1px solid #e5e7eb;">
							<td style="padding: 0.75rem; font-weight: 500;">App Version</td>
							<td style="padding: 0.75rem;" id="app-version">1.12.0</td>
						</tr>
						<tr style="border-bottom: 1px solid #e5e7eb;">
							<td style="padding: 0.75rem; font-weight: 500;">Browser</td>
							<td style="padding: 0.75rem;" id="browser-info">Loading...</td>
						</tr>
						<tr style="border-bottom: 1px solid #e5e7eb;">
							<td style="padding: 0.75rem; font-weight: 500;">Offline Mode</td>
							<td style="padding: 0.75rem;" id="offline-status">Checking...</td>
						</tr>
						<tr style="border-bottom: 1px solid #e5e7eb;">
							<td style="padding: 0.75rem; font-weight: 500;">Service Worker</td>
							<td style="padding: 0.75rem;" id="sw-status">Checking...</td>
						</tr>
						<tr>
							<td style="padding: 0.75rem; font-weight: 500;">Last Updated</td>
							<td style="padding: 0.75rem;">November 2025</td>
						</tr>
					</table>
				</div>
			</div>

			<!-- Data Management -->
			<div class="card" style="margin-bottom: 1.5rem;">
				<div class="card-header">
					<h3 class="card-title">üóëÔ∏è Data Management</h3>
				</div>
				<div class="card-body">
					<p style="margin-bottom: 1rem;">Manage your application data. These actions cannot be undone!</p>

					<div style="display: grid; gap: 0.5rem;">
						<button class="btn btn-secondary" onclick="clearOldQuotes()" aria-label="Clear old quotes">
							Clear Old Quotes (90+ days)
						</button>
						<button class="btn btn-secondary" onclick="compressPhotos()" aria-label="Compress photos">
							Compress All Photos
						</button>
						<button class="btn btn-danger" onclick="confirmClearAllData()" aria-label="Clear all data">
							‚ö†Ô∏è Clear All Data
						</button>
					</div>
				</div>
			</div>

			<!-- About Section -->
			<div class="card">
				<div class="card-header">
					<h3 class="card-title">üìã About TicTacStick</h3>
				</div>
				<div class="card-body">
					<p><strong>TicTacStick Quote Engine</strong></p>
					<p>Professional quote and business management system for 925 Pressure Glass</p>
					<p style="margin-top: 1rem; color: #6b7280; font-size: 0.875rem;">
						Window & Pressure Cleaning Services<br>
						Perth, Western Australia<br>
						<br>
						üìß support@925pressureglass.com.au<br>
						üìû 0400 000 000
					</p>
					<p style="margin-top: 1rem; color: #6b7280; font-size: 0.75rem;">
						¬© 2025 925 Pressure Glass. All rights reserved.
					</p>
				</div>
			</div>
		</div>
	</div>

	<!-- SCRIPTS -->
	<!-- Config must load FIRST to define global constants -->
	<script src="config.js"></script>

	<!-- Bootstrap must load SECOND to create APP namespace -->
	<script src="bootstrap.js"></script>

	<!-- Capacitor Core (for native mobile app features) -->
	<script>
		(function() {
			var automation = !!window.APP_TEST_MODE;
			if (automation) {
				document.write('<script src="vendor/capacitor-stub.js"><\\/script>');
			} else {
				document.write('<script type="module" src="https://unpkg.com/@capacitor/core@latest/dist/capacitor.js"><\\/script>');
			}
		})();
	</script>

	<!-- External dependencies -->
	<!-- Chart.js temporarily commented out for testing - network issues in test environment -->
	<!-- <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script> -->
	<!-- jsPDF for quote PDF generation -->
	<script>
		(function() {
			var automation = !!window.APP_TEST_MODE;
			if (automation) {
				document.write('<script src="vendor/jspdf-stub.js"><\\/script>');
			} else {
				document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer><\\/script>');
			}
		})();
	</script>

	<!-- Core modules (load in dependency order) -->
	<!-- Debug system loads first (no defer - must be available immediately) -->
	<script src="debug.js"></script>
	<!-- Security utilities (no defer - must be available before other modules) -->
	<script src="security.js"></script>
	<!-- Validation system (no defer - must be available before invoice and other modules) -->
	<script src="validation.js"></script>
	<!-- Quote validation system (no defer - must be available before app.js) -->
	<script src="quote-validation.js"></script>
	<!-- UI Components (toast, loading, modals) - no defer for immediate availability -->
	<script src="ui-components.js"></script>
	<!-- Lazy loader for on-demand module loading -->
	<script src="lazy-loader.js"></script>
	<!-- Lazy loader initialization and event handlers -->
	<script src="lazy-loader-init.js" defer></script>
	<!-- Chart.js for analytics charts - loaded on demand by LazyLoader -->
	<!-- <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script> -->
	<!-- Enhanced Australian window types and modifiers (must load before data.js) -->
	<script src="window-types-extended.js" defer></script>
	<script src="conditions-modifiers.js" defer></script>
	<script src="pressure-surfaces-extended.js" defer></script>
	<script src="data.js" defer></script>
	<script src="quote-migration.js" defer></script>
	<script src="storage.js" defer></script>
	<script src="calc.js" defer></script>
	<script src="app.js" defer></script>

	<!-- Phase 2: Mobile UI Components -->
	<script src="quick-add-ui.js" defer></script>
	<script src="custom-window-calculator.js" defer></script>

	<!-- Phase 4: Business Intelligence -->
	<script src="travel-calculator.js" defer></script>
	<script src="profitability-analyzer.js" defer></script>

	<!-- Phase 5: Job Templates -->
	<script src="job-presets.js" defer></script>

	<!-- Task & Follow-up Automation (Prompt #29) -->
	<script src="followup-config.js" defer></script>
	<script src="task-manager.js" defer></script>
	<script src="followup-automation.js" defer></script>
	<script src="ghl-task-sync.js" defer></script>
	<script src="task-dashboard-ui.js" defer></script>

	<!-- Contract Management & Recurring Revenue System (NEW v1.12.0) -->
	<script src="contract-manager.js" defer></script>
	<script src="contract-wizard.js" defer></script>
	<script src="contract-automation.js" defer></script>
	<script src="contract-forecasting.js" defer></script>

	<!-- Native Mobile Features (Capacitor Integration - NEW v1.13.0) -->
	<script src="native-features.js" defer></script>
	<script src="camera-helper.js" defer></script>
	<script src="push-notifications.js" defer></script>
	<script src="geolocation-helper.js" defer></script>

	<!-- Error handler must load early for other modules -->
	<script src="error-handler.js" defer></script>

	<!-- UI and feature modules -->
	<script src="navigation.js" defer></script>
	<script src="event-handlers.js" defer></script>
	<script src="ui.js" defer></script>
	<script src="wizard.js" defer></script>
	<script src="loading.js" defer></script>
	<script src="accessibility.js" defer></script>
	<script src="client-database.js" defer></script>
	<script src="customer-directory-ui.js" defer></script>
	<script src="quote-workflow.js" defer></script>
	<script src="import-export.js" defer></script>
	<script src="csv-import.js" defer></script>
	<script src="selective-export.js" defer></script>
	<script src="invoice.js" defer></script>
	<!-- GoHighLevel Integration & Webhook Modules -->
	<script src="ghl-client.js" defer></script>
	<script src="ghl-opportunity-sync.js" defer></script>
	<script src="webhook-processor.js" defer></script>
	<script src="ghl-webhook-setup.js" defer></script>
	<script src="webhook-settings.js" defer></script>
	<script src="webhook-debug.js" defer></script>
	<script src="ghl-settings-ui.js" defer></script>
	<script src="theme.js" defer></script>
	<script src="theme-customizer.js" defer></script>
	<script src="shortcuts.js" defer></script>
	<!-- In-App Help System -->
	<script src="help-system.js" defer></script>
	<script src="export.js" defer></script>
	<script src="templates.js" defer></script>
	<!-- PDF Generation Modules -->
	<script src="pdf-config.js" defer></script>
	<script src="pdf-components.js" defer></script>
	<script src="quote-pdf.js" defer></script>
	<script src="quote-pdf-ui.js" defer></script>
        <!-- Lazy-loaded modules (loaded on demand via LazyLoader) -->
        <!-- Analytics System -->
        <script data-late-src="analytics-config.js" data-module="analytics"></script>
        <script data-late-src="analytics-engine.js" data-module="analytics"></script>
        <script data-late-src="analytics-dashboard.js" data-module="analytics"></script>
        <script data-late-src="analytics.js" data-module="analytics"></script>
        <!-- <script src="charts.js" defer></script> -->
        <!-- <script src="photo-modal.js" defer></script> -->
        <script data-late-src="photos.js" data-module="photos"></script>

	<!-- Production Polish & Testing Tools -->
	<!-- Deployment helper for pre-deployment checks -->
	<script src="deployment-helper.js" defer></script>
	<!-- Health monitoring for production environment -->
	<script src="health-check.js" defer></script>
	<!-- Bug tracking and reporting system -->
	<script src="bug-tracker.js" defer></script>
	<!-- Performance Monitoring (Enhanced) -->
	<script src="performance-monitor-enhanced.js" defer></script>
	<!-- Storage Quota Management -->
	<script src="storage-quota-manager.js" defer></script>
	<!-- Input Debouncing (Enhanced) -->
	<script src="input-debounce-enhanced.js" defer></script>
	<!-- Calculation Optimizer -->
	<script src="calculation-optimizer.js" defer></script>
	<!-- Test Framework & QA Tools -->
	<script src="test-framework.js" defer></script>
	<script src="test-suites.js" defer></script>
	<script src="integration-tests.js" defer></script>
	<script src="performance-tests.js" defer></script>
	<script src="test-runner.js" defer></script>
        <script src="test-checklist.js" defer></script>
        <script src="production-readiness.js" defer></script>

        <!-- Backup & Restore System -->
        <script data-late-src="backup-manager.js" data-module="backup"></script>

	<!-- Job Tracking & Pricing Intelligence System (NEW v1.13.0) -->
	<script src="job-manager.js" defer></script>
	<script src="pricing-intelligence.js" defer></script>
	<script src="photo-comparison.js" defer></script>
	<script src="job-tracking-ui.js" defer></script>
	<script src="job-tracking-global.js" defer></script>

        <!-- Production Configuration (loads last to override development settings) -->
        <script src="config-production.js" defer></script>

        <!-- MANUAL TEST SUITES (uncomment for testing, comment out for production) -->
        <!-- Pricing calculation tests: PricingTests.runAll() -->
        <!-- <script src="tests/manual/pricing-tests.js" defer></script> -->
        <!-- Storage operation tests: StorageTests.runAll() -->
        <!-- <script src="tests/manual/storage-tests.js" defer></script> -->
        <!-- Performance benchmarks: PerformanceTests.runAll() -->
        <!-- <script src="tests/manual/performance-tests.js" defer></script> -->

        <!-- Deferred asset loader to hydrate non-critical styles and scripts after DOM is ready -->
        <script>
                (function() {
                        var isTestMode = !!window.APP_TEST_MODE;
                        var skipLateModules = window.APP_TEST_SKIP_MODULES || ['photos', 'backup'];
                        var skipLateStyles = window.APP_TEST_SKIP_STYLES || ['photo-modal.css', 'photos.css'];

                        function showDeferredPlaceholders() {
                                if (window.APP && APP.showDeferredPlaceholder) {
                                        APP.showDeferredPlaceholder('page-analytics-dashboard', 'Loading analytics toolkit...');
                                        APP.showDeferredPlaceholder('photos-grid', 'Preparing photo tools...');
                                        APP.showDeferredPlaceholder('page-settings', 'Loading backup tools...');
                                }
                        }

                        function shouldSkipStyle(link) {
                                if (!isTestMode) {
                                        return false;
                                }

                                var href = link.getAttribute('href') || '';
                                for (var i = 0; i < skipLateStyles.length; i++) {
                                        if (href.indexOf(skipLateStyles[i]) !== -1) {
                                                return true;
                                        }
                                }

                                return false;
                        }

                        function hydrateDeferredStyles() {
                                var lateStyles = document.querySelectorAll('link[data-late-style]');
                                for (var i = 0; i < lateStyles.length; i++) {
                                        var link = lateStyles[i];
                                        if (shouldSkipStyle(link)) {
                                                continue;
                                        }
                                        link.rel = 'stylesheet';
                                        link.removeAttribute('data-late-style');
                                        link.removeAttribute('as');
                                }
                        }

                        function handleLateLoad(moduleName) {
                                if (!moduleName || !window.APP || !APP.hideDeferredPlaceholder) {
                                        return;
                                }

                                if (moduleName === 'analytics') {
                                        APP.hideDeferredPlaceholder('page-analytics-dashboard');
                                } else if (moduleName === 'photos') {
                                        APP.hideDeferredPlaceholder('photos-grid');
                                } else if (moduleName === 'backup') {
                                        APP.hideDeferredPlaceholder('page-settings');
                                }
                        }

                        function hydrateDeferredScripts() {
                                var lateScripts = document.querySelectorAll('script[data-late-src]');
                                for (var i = 0; i < lateScripts.length; i++) {
                                        var placeholder = lateScripts[i];
                                        var moduleName = placeholder.getAttribute('data-module');
                                        var src = placeholder.getAttribute('data-late-src');
                                        if (!src) {
                                                continue;
                                        }

                                        if (isTestMode && moduleName && skipLateModules.indexOf(moduleName) !== -1) {
                                                continue;
                                        }

                                        var script = document.createElement('script');
                                        script.src = src;
                                        script.defer = true;
                                        script.async = false;

                                        (function(name) {
                                                script.onload = function() {
                                                        handleLateLoad(name);
                                                };
                                        })(moduleName);

                                        placeholder.parentNode.replaceChild(script, placeholder);
                                }
                        }

                        function initDeferredAssets() {
                                showDeferredPlaceholders();
                                hydrateDeferredStyles();
                                hydrateDeferredScripts();
                        }

                        if (document.readyState === 'loading') {
                                document.addEventListener('DOMContentLoaded', initDeferredAssets);
                        } else {
                                initDeferredAssets();
                        }
                })();
        </script>

	<!-- Webhook Settings Modal Functions -->
	<script>
		// Open webhook settings modal
		function openWebhookSettings() {
			var modal = document.getElementById('webhookSettingsModal');
			if (modal) {
				modal.style.display = 'flex';
				if (window.WebhookSettings && window.WebhookSettings.init) {
					window.WebhookSettings.init();
				}
			}
		}

		// Close webhook settings modal
		function closeWebhookSettings() {
			var modal = document.getElementById('webhookSettingsModal');
			if (modal) {
				modal.style.display = 'none';
				if (window.WebhookSettings && window.WebhookSettings.cleanup) {
					window.WebhookSettings.cleanup();
				}
			}
		}

		// Trigger manual sync
		function triggerManualSync() {
			if (window.WebhookSettings && window.WebhookSettings.triggerManualSync) {
				window.WebhookSettings.triggerManualSync();
			}
		}

		// Save webhook settings
		function saveWebhookSettings() {
			if (window.WebhookSettings && window.WebhookSettings.saveSettings) {
				window.WebhookSettings.saveSettings();
			}
		}

		// Test webhook endpoint
		function testWebhookEndpoint() {
			if (window.WebhookSettings && window.WebhookSettings.testWebhookEndpoint) {
				window.WebhookSettings.testWebhookEndpoint();
			}
		}

		// Register webhook with GHL
		function registerWebhookWithGHL() {
			if (window.WebhookSettings && window.WebhookSettings.registerWebhookWithGHL) {
				window.WebhookSettings.registerWebhookWithGHL();
			}
		}

		// Unregister webhook from GHL
		function unregisterWebhookFromGHL() {
			if (window.WebhookSettings && window.WebhookSettings.unregisterWebhookFromGHL) {
				window.WebhookSettings.unregisterWebhookFromGHL();
			}
		}

		// View event queue
		function viewEventQueue() {
			if (window.WebhookSettings && window.WebhookSettings.viewEventQueue) {
				window.WebhookSettings.viewEventQueue();
			}
		}

		// Clear event queue
		function clearEventQueue() {
			if (window.WebhookSettings && window.WebhookSettings.clearEventQueue) {
				window.WebhookSettings.clearEventQueue();
			}
		}

		// Close modal on overlay click
		document.addEventListener('DOMContentLoaded', function() {
			var modal = document.getElementById('webhookSettingsModal');
			if (modal) {
				modal.addEventListener('click', function(e) {
					if (e.target === modal) {
						closeWebhookSettings();
					}
				});
			}
		});
	</script>

	<!-- Test Runner Functions -->
	<script>
		// Open test runner modal
		function openTestRunner() {
			var modal = document.getElementById('testRunnerModal');
			if (modal) {
				modal.style.display = 'flex';
				document.body.classList.add('modal-open');
			}
		}

		// Close test runner modal
		function closeTestRunner() {
			var modal = document.getElementById('testRunnerModal');
			if (modal) {
				modal.style.display = 'none';
				document.body.classList.remove('modal-open');
			}
		}

		// Show test tab
		function showTestTab(tabName) {
			// Hide all tabs
			var tabs = document.querySelectorAll('.tab-content');
			for (var i = 0; i < tabs.length; i++) {
				tabs[i].style.display = 'none';
			}

			// Remove active class from all buttons
			var btns = document.querySelectorAll('#testRunnerModal .tab-btn');
			for (var i = 0; i < btns.length; i++) {
				btns[i].classList.remove('active');
			}

			// Show selected tab
			var selectedTab = document.getElementById('test-tab-' + tabName);
			if (selectedTab) {
				selectedTab.style.display = 'block';
			}

			// Add active class to clicked button
			var clickedBtn = event.target;
			if (clickedBtn) {
				clickedBtn.classList.add('active');
			}
		}

		// Run production readiness check and display results
		function runProductionReadinessCheck() {
			if (typeof ProductionReadiness === 'undefined') {
				alert('Production readiness checker not loaded');
				return;
			}

			if (typeof UIComponents !== 'undefined' && UIComponents.showLoading) {
				UIComponents.showLoading('Running production readiness check...');
			}

			setTimeout(function() {
				var results = ProductionReadiness.runCheck();

				if (typeof UIComponents !== 'undefined' && UIComponents.hideLoading) {
					UIComponents.hideLoading();
				}

				// Display results
				displayReadinessResults(results);
			}, 100);
		}

		// Display readiness results
		function displayReadinessResults(results) {
			var container = document.getElementById('production-readiness-results');
			if (!container) return;

			var scoreClass = 'not-ready';
			var scoreLabel = 'NOT READY';
			if (results.score === 100) {
				scoreClass = 'ready';
				scoreLabel = 'PRODUCTION READY ‚úì';
			} else if (results.score >= 90) {
				scoreClass = 'mostly-ready';
				scoreLabel = 'MOSTLY READY';
			} else if (results.score >= 75) {
				scoreClass = 'caution';
				scoreLabel = 'CAUTION';
			}

			var html = '';
			html += '<div class="readiness-score ' + scoreClass + '">' + results.score + '/100</div>';
			html += '<p style="text-align: center; font-size: 1.25rem; font-weight: 600; margin-bottom: 2rem;">' + scoreLabel + '</p>';

			if (results.passed.length > 0) {
				html += '<div class="readiness-section">';
				html += '<h4 class="readiness-section-title">‚úì Passed (' + results.passed.length + ')</h4>';
				html += '<ul class="readiness-list">';
				for (var i = 0; i < results.passed.length; i++) {
					html += '<li class="passed">‚úì ' + escapeHtml(results.passed[i]) + '</li>';
				}
				html += '</ul></div>';
			}

			if (results.warnings.length > 0) {
				html += '<div class="readiness-section">';
				html += '<h4 class="readiness-section-title">‚ö†Ô∏è Warnings (' + results.warnings.length + ')</h4>';
				html += '<ul class="readiness-list">';
				for (var i = 0; i < results.warnings.length; i++) {
					html += '<li class="warning">‚ö†Ô∏è ' + escapeHtml(results.warnings[i]) + '</li>';
				}
				html += '</ul></div>';
			}

			if (results.failed.length > 0) {
				html += '<div class="readiness-section">';
				html += '<h4 class="readiness-section-title">‚úó Failed (' + results.failed.length + ')</h4>';
				html += '<ul class="readiness-list">';
				for (var i = 0; i < results.failed.length; i++) {
					html += '<li class="failed">‚úó ' + escapeHtml(results.failed[i]) + '</li>';
				}
				html += '</ul></div>';
			}

			container.innerHTML = html;
		}

		// HTML escape helper
		function escapeHtml(text) {
			var div = document.createElement('div');
			div.textContent = text;
			return div.innerHTML;
		}

		// Close modal on overlay click
		document.addEventListener('DOMContentLoaded', function() {
			var modal = document.getElementById('testRunnerModal');
			if (modal) {
				modal.addEventListener('click', function(e) {
					if (e.target === modal) {
						closeTestRunner();
					}
				});
			}
		});
	</script>

	<!-- Job Tracking Helper Functions -->
	<script>
		// Global helper functions for job tracking

		/**
		 * Take before photo (enhanced with camera helper)
		 */
		function takeBeforePhoto() {
			// Try to use CameraHelper if available
			if (window.CameraHelper && window.CameraHelper.isAvailable && window.CameraHelper.isAvailable()) {
				window.CameraHelper.takePhoto({
					quality: 0.8,
					resultType: 'dataUrl'
				}).then(function(result) {
					var location = prompt('Photo location:', 'Front entrance');
					var notes = prompt('Photo notes:', 'Before cleaning');

					if (window.JobManager && window.JobTrackingUI && window.JobTrackingUI._currentJobId) {
						window.JobManager.addPhoto(window.JobTrackingUI._currentJobId, 'before', result.dataUrl, location, notes);

						var job = window.JobManager.getJob(window.JobTrackingUI._currentJobId);
						if (job) {
							var container = document.getElementById('photos-grid');
							if (container) window.JobTrackingUI.renderPhotos(job);
							if (window.UIComponents && window.UIComponents.showToast) {
								window.UIComponents.showToast('Before photo added', 'success');
							}
						}
					}
				}).catch(function(error) {
					console.error('[PHOTO] Camera error:', error);
					// Fallback to file input
					takePhotoFallback('before');
				});
			} else {
				// Fallback to file input
				takePhotoFallback('before');
			}
		}

		/**
		 * Take after photo (enhanced with camera helper)
		 */
		function takeAfterPhoto() {
			// Try to use CameraHelper if available
			if (window.CameraHelper && window.CameraHelper.isAvailable && window.CameraHelper.isAvailable()) {
				window.CameraHelper.takePhoto({
					quality: 0.8,
					resultType: 'dataUrl'
				}).then(function(result) {
					var location = prompt('Photo location:', 'Front entrance');
					var notes = prompt('Photo notes:', 'After cleaning');

					if (window.JobManager && window.JobTrackingUI && window.JobTrackingUI._currentJobId) {
						window.JobManager.addPhoto(window.JobTrackingUI._currentJobId, 'after', result.dataUrl, location, notes);

						var job = window.JobManager.getJob(window.JobTrackingUI._currentJobId);
						if (job) {
							var container = document.getElementById('photos-grid');
							if (container) window.JobTrackingUI.renderPhotos(job);
							if (window.UIComponents && window.UIComponents.showToast) {
								window.UIComponents.showToast('After photo added', 'success');
							}
						}
					}
				}).catch(function(error) {
					console.error('[PHOTO] Camera error:', error);
					// Fallback to file input
					takePhotoFallback('after');
				});
			} else {
				// Fallback to file input
				takePhotoFallback('after');
			}
		}

		/**
		 * Fallback photo capture using file input
		 * @param {string} type - 'before' or 'after'
		 */
		function takePhotoFallback(type) {
			var input = document.createElement('input');
			input.type = 'file';
			input.accept = 'image/*';
			input.capture = 'camera';  // Request camera on mobile
			input.onchange = function(e) {
				var file = e.target.files[0];
				if (file) {
					var reader = new FileReader();
					reader.onload = function(event) {
						var location = prompt('Photo location:', 'Front entrance');
						var notes = prompt('Photo notes:', type === 'before' ? 'Before cleaning' : 'After cleaning');

						if (window.JobManager && window.JobTrackingUI && window.JobTrackingUI._currentJobId) {
							window.JobManager.addPhoto(window.JobTrackingUI._currentJobId, type, event.target.result, location, notes);

							var job = window.JobManager.getJob(window.JobTrackingUI._currentJobId);
							if (job) {
								var container = document.getElementById('photos-grid');
								if (container) window.JobTrackingUI.renderPhotos(job);
								if (window.UIComponents && window.UIComponents.showToast) {
									window.UIComponents.showToast(type + ' photo added', 'success');
								}
							}
						}
					};
					reader.readAsDataURL(file);
				}
			};
			input.click();
		}

		/**
		 * Record job issue
		 */
		function recordJobIssue() {
			if (!window.JobTrackingUI || !window.JobTrackingUI._currentJobId) return;

			var type = prompt('Issue type (access/equipment/weather/damage/other):', 'access');
			if (!type) return;

			var description = prompt('Describe the issue:');
			if (!description) return;

			var severity = prompt('Severity (low/medium/high):', 'medium');
			var impact = prompt('Impact on job:');
			var resolution = prompt('How was it resolved:');

			window.JobManager.recordIssue(window.JobTrackingUI._currentJobId, {
				type: type,
				description: description,
				severity: severity,
				impact: impact,
				resolution: resolution
			});

			var job = window.JobManager.getJob(window.JobTrackingUI._currentJobId);
			if (job) {
				var container = document.getElementById('issues-notes-list');
				if (container) window.JobTrackingUI.renderIssuesAndNotes(job);
			}

			if (window.UIComponents && window.UIComponents.showToast) {
				window.UIComponents.showToast('Issue recorded', 'warning');
			}
		}

		/**
		 * Add job note
		 */
		function addJobNote() {
			if (!window.JobTrackingUI || !window.JobTrackingUI._currentJobId) return;

			var note = prompt('Add note:');
			if (!note) return;

			var type = prompt('Note type (client-preference/observation/reminder/other):', 'observation');

			window.JobManager.addNote(window.JobTrackingUI._currentJobId, note, type);

			var job = window.JobManager.getJob(window.JobTrackingUI._currentJobId);
			if (job) {
				var container = document.getElementById('issues-notes-list');
				if (container) window.JobTrackingUI.renderIssuesAndNotes(job);
			}

			if (window.UIComponents && window.UIComponents.showToast) {
				window.UIComponents.showToast('Note added', 'success');
			}
		}

		/**
		 * Add scope change
		 */
		function addScopeChange() {
			if (!window.JobTrackingUI || !window.JobTrackingUI._currentJobId) return;

			var description = prompt('Describe additional work:');
			if (!description) return;

			var quantity = parseFloat(prompt('Quantity:', '1'));
			var unitPrice = parseFloat(prompt('Price per unit:', '50'));
			var time = parseFloat(prompt('Time spent (minutes):', '30'));

			var approved = confirm('Has client approved this additional work?');

			window.JobManager.addAdditionalWork(window.JobTrackingUI._currentJobId, {
				description: description,
				quantity: quantity,
				unitPrice: unitPrice,
				time: time
			}, approved);

			var job = window.JobManager.getJob(window.JobTrackingUI._currentJobId);
			if (job) {
				var container = document.getElementById('work-items-list');
				if (container) window.JobTrackingUI.renderWorkItems(job);
				window.JobTrackingUI.updatePricingDisplay(job);
			}

			if (window.UIComponents && window.UIComponents.showToast) {
				window.UIComponents.showToast('Additional work added', 'success');
			}
		}

		/**
		 * Update difficulty
		 */
		function updateDifficulty() {
			if (!window.JobTrackingUI || !window.JobTrackingUI._currentJobId) return;

			var job = window.JobManager.getJob(window.JobTrackingUI._currentJobId);
			if (!job) return;

			var itemIndex = parseInt(prompt('Which item to update? (0-' + (job.actual.items.length - 1) + '):', '0'));

			if (isNaN(itemIndex) || itemIndex < 0 || itemIndex >= job.actual.items.length) {
				alert('Invalid item index');
				return;
			}

			var difficulty = prompt('New difficulty (easy/normal/hard/very-hard):', 'normal');

			window.JobManager.updateItemActual(window.JobTrackingUI._currentJobId, itemIndex, {
				actualDifficulty: difficulty.toLowerCase()
			});

			job = window.JobManager.getJob(window.JobTrackingUI._currentJobId);
			if (job) {
				var container = document.getElementById('work-items-list');
				if (container) window.JobTrackingUI.renderWorkItems(job);
			}

			if (window.UIComponents && window.UIComponents.showToast) {
				window.UIComponents.showToast('Difficulty updated', 'success');
			}
		}

		// Job creation functions (showCreateJobDialog, closeCreateJobDialog, createJobFromQuote, generateJobInvoiceFromList) are now defined in job-tracking-global.js
	</script>

	<!-- Contract Page Helper Functions & UI Controller -->
	<script>
		// Open contract wizard
		function openContractWizard() {
			if (window.ContractWizard && window.ContractWizard.open) {
				window.ContractWizard.open();
			} else {
				console.warn('[CONTRACTS] ContractWizard.open not available');
				alert('Contract Wizard is loading... Please try again in a moment.');
			}
		}

		// Export contracts
		function exportContracts() {
			if (!window.ContractManager) {
				console.warn('[CONTRACTS] ContractManager not available');
				return;
			}

			try {
				var contracts = window.ContractManager.getAllContracts();
				var json = JSON.stringify(contracts, null, 2);
				var blob = new Blob([json], { type: 'application/json' });
				var url = URL.createObjectURL(blob);
				var a = document.createElement('a');
				a.href = url;
				a.download = 'contracts-export-' + Date.now() + '.json';
				a.click();
				URL.revokeObjectURL(url);

				if (window.UIComponents && window.UIComponents.showToast) {
					window.UIComponents.showToast('Contracts exported successfully', 'success');
				}
			} catch (e) {
				console.error('[CONTRACTS] Export failed:', e);
				if (window.UIComponents && window.UIComponents.showToast) {
					window.UIComponents.showToast('Export failed: ' + e.message, 'error');
				}
			}
		}

		// Render contracts list
		function renderContractsList() {
			if (!window.ContractManager) {
				console.warn('[CONTRACTS] ContractManager not available');
				return;
			}

			try {
				// Get contracts
				var contracts = window.ContractManager.getAllContracts();
				var stats = window.ContractManager.getContractStats();

				// Update summary cards
				document.getElementById('contract-count-active').textContent = stats.activeCount || 0;
				document.getElementById('contract-mrr').textContent = '$' + ((stats.mrr || 0).toFixed(2));
				document.getElementById('contract-arr').textContent = '$' + ((stats.arr || 0).toFixed(2));
				document.getElementById('contract-total-value').textContent = '$' + ((stats.totalValue || 0).toFixed(2));

				// Render contracts list
				var listEl = document.getElementById('contracts-list');
				if (!listEl) return;

				if (!contracts || contracts.length === 0) {
					listEl.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 2rem;">No contracts found. Click "New Contract" to create your first contract.</p>';
					return;
				}

				// Build HTML
				var html = '<div class="contracts-table">';
				html += '<table style="width: 100%; border-collapse: collapse;">';
				html += '<thead><tr>';
				html += '<th style="text-align: left; padding: 0.75rem; border-bottom: 2px solid #e5e7eb;">Contract #</th>';
				html += '<th style="text-align: left; padding: 0.75rem; border-bottom: 2px solid #e5e7eb;">Client</th>';
				html += '<th style="text-align: left; padding: 0.75rem; border-bottom: 2px solid #e5e7eb;">Type</th>';
				html += '<th style="text-align: left; padding: 0.75rem; border-bottom: 2px solid #e5e7eb;">Frequency</th>';
				html += '<th style="text-align: right; padding: 0.75rem; border-bottom: 2px solid #e5e7eb;">Value</th>';
				html += '<th style="text-align: left; padding: 0.75rem; border-bottom: 2px solid #e5e7eb;">Status</th>';
				html += '<th style="text-align: left; padding: 0.75rem; border-bottom: 2px solid #e5e7eb;">Next Service</th>';
				html += '<th style="text-align: center; padding: 0.75rem; border-bottom: 2px solid #e5e7eb;">Actions</th>';
				html += '</tr></thead>';
				html += '<tbody>';

				for (var i = 0; i < contracts.length; i++) {
					var contract = contracts[i];
					var statusColors = {
						'active': '#10b981',
						'draft': '#6b7280',
						'paused': '#f59e0b',
						'cancelled': '#ef4444',
						'expired': '#9ca3af'
					};
					var statusColor = statusColors[contract.status] || '#6b7280';

					html += '<tr style="border-bottom: 1px solid #e5e7eb;">';
					html += '<td style="padding: 0.75rem;"><strong>' + (contract.contractNumber || contract.id) + '</strong></td>';
					html += '<td style="padding: 0.75rem;">' + (contract.clientName || 'Unknown') + '</td>';
					html += '<td style="padding: 0.75rem;">' + (contract.type || 'N/A') + '</td>';
					html += '<td style="padding: 0.75rem;">' + (contract.frequency || 'N/A') + '</td>';
					html += '<td style="padding: 0.75rem; text-align: right;">$' + ((contract.pricing && contract.pricing.finalPrice) || 0).toFixed(2) + '</td>';
					html += '<td style="padding: 0.75rem;"><span style="display: inline-block; padding: 0.25rem 0.5rem; border-radius: 0.25rem; background: ' + statusColor + '22; color: ' + statusColor + '; font-size: 0.875rem; font-weight: 500;">' + (contract.status || 'Unknown') + '</span></td>';
					html += '<td style="padding: 0.75rem;">' + (contract.nextServiceDate ? new Date(contract.nextServiceDate).toLocaleDateString() : 'N/A') + '</td>';
					html += '<td style="padding: 0.75rem; text-align: center;"><button class="btn btn-sm btn-tertiary" onclick="viewContract(\'' + contract.id + '\')">View</button></td>';
					html += '</tr>';
				}

				html += '</tbody></table></div>';
				listEl.innerHTML = html;

			} catch (e) {
				console.error('[CONTRACTS] Render failed:', e);
			}
		}

		// View contract details
		function viewContract(contractId) {
			console.log('[CONTRACTS] View contract:', contractId);
			// TODO: Implement contract detail view
			alert('Contract detail view coming soon! Contract ID: ' + contractId);
		}

		// Filter contracts
		function filterContracts() {
			// TODO: Implement filtering logic
			renderContractsList();
		}

		// Add renderContractsList to ContractManager if it exists
		if (window.ContractManager) {
			window.ContractManager.renderContractsList = renderContractsList;
		}
	</script>

	<!-- Analytics Page Helper Functions & UI Controller -->
	<script>
		// Initialize and render analytics dashboard
		function renderAnalyticsDashboard() {
			if (!window.AnalyticsDashboard) {
				console.warn('[ANALYTICS] AnalyticsDashboard not available');
				return;
			}

			try {
				// Initialize if not already done
				if (window.AnalyticsDashboard.init) {
					window.AnalyticsDashboard.init();
				}

				// Update dashboard with current data
				if (window.AnalyticsDashboard.updateDashboard) {
					window.AnalyticsDashboard.updateDashboard();
				}

				console.log('[ANALYTICS] Dashboard rendered');
			} catch (e) {
				console.error('[ANALYTICS] Render failed:', e);
			}
		}

		// Update analytics period
		function updateAnalyticsPeriod() {
			var period = document.getElementById('analytics-period').value;
			console.log('[ANALYTICS] Update period:', period);

			// TODO: Implement period filtering in analytics engine
			// For now, just refresh the dashboard
			if (window.AnalyticsDashboard && window.AnalyticsDashboard.updateDashboard) {
				window.AnalyticsDashboard.updateDashboard();
			}
		}

		// Export analytics
		function exportAnalytics() {
			if (window.AnalyticsDashboard && window.AnalyticsDashboard.exportDashboard) {
				window.AnalyticsDashboard.exportDashboard();
			} else {
				console.warn('[ANALYTICS] Export not available');
				if (window.UIComponents && window.UIComponents.showToast) {
					window.UIComponents.showToast('Export feature not available', 'warning');
				}
			}
		}

		// Refresh analytics
		function refreshAnalytics() {
			if (window.AnalyticsDashboard && window.AnalyticsDashboard.updateDashboard) {
				window.AnalyticsDashboard.updateDashboard();
				if (window.UIComponents && window.UIComponents.showToast) {
					window.UIComponents.showToast('Analytics refreshed', 'success');
				}
			} else {
				console.warn('[ANALYTICS] Refresh not available');
			}
		}

		// Add render function to AnalyticsDashboard if it exists
		if (window.AnalyticsDashboard) {
			window.AnalyticsDashboard.render = renderAnalyticsDashboard;
		}
	</script>

	<!-- Help System Helper Functions & UI Controller -->
	<script>
		// Help content database
		var HELP_TOPICS = {
			'getting-started': {
				title: 'Getting Started',
				content: '<h2>Getting Started with TicTacStick</h2><p>Welcome! TicTacStick is a complete quote and business management system for window and pressure cleaning services.</p><h3>Quick Start Guide</h3><ol><li><strong>Create Your First Quote:</strong> Fill in the client details at the top, then add window or pressure cleaning line items.</li><li><strong>Use Wizards:</strong> Click "Wizard Mode" for guided quote creation.</li><li><strong>Convert to Invoice:</strong> Once accepted, convert your quote to an invoice.</li><li><strong>Track Jobs:</strong> Use the Jobs page to track active work.</li><li><strong>Manage Clients:</strong> Build your client database for repeat business.</li></ol><h3>Key Features</h3><ul><li>‚úÖ Offline-first - works without internet</li><li>‚úÖ Mobile-optimized for field use</li><li>‚úÖ Automatic calculations</li><li>‚úÖ PDF generation</li><li>‚úÖ CRM integration</li></ul>'
			},
			'quotes': {
				title: 'Creating Quotes',
				content: '<h2>How to Create a Quote</h2><h3>Basic Quote Creation</h3><ol><li><strong>Enter Client Info:</strong> Quote Title, Client Name, Location, Job Type</li><li><strong>Set Job Settings:</strong> Base Fee ($120), Hourly Rate ($95), Minimum Job ($180)</li><li><strong>Add Line Items:</strong><ul><li>Windows: Select type, enter quantity and panes</li><li>Pressure: Select surface, enter area in square meters</li></ul></li><li><strong>Review Total:</strong> Check the summary panel on the right</li><li><strong>Save or Export:</strong> Use "Save Quote" or "Generate PDF"</li></ol><h3>Pro Tips</h3><ul><li>Use the Wizard Mode for guided input</li><li>Add photos for documentation</li><li>Save as template for similar jobs</li><li>Add internal notes for your reference</li></ul>'
			},
			'invoices': {
				title: 'Invoicing',
				content: '<h2>Converting Quotes to Invoices</h2><h3>Create Invoice</h3><ol><li>Open a saved quote</li><li>Click "Convert to Invoice"</li><li>Set invoice number and date</li><li>Add payment terms</li><li>Send to client</li></ol><h3>Recording Payments</h3><ol><li>Open the invoice</li><li>Click "Record Payment"</li><li>Enter amount and payment method</li><li>Add reference number if applicable</li></ol><h3>Invoice Status</h3><ul><li><strong>Draft:</strong> Not yet sent</li><li><strong>Sent:</strong> Delivered to client</li><li><strong>Paid:</strong> Payment received</li><li><strong>Overdue:</strong> Past due date</li><li><strong>Cancelled:</strong> Voided</li></ul>'
			},
			'contracts': {
				title: 'Contract Management',
				content: '<h2>Managing Recurring Contracts</h2><h3>Create a Contract</h3><ol><li>Go to Contracts page</li><li>Click "New Contract"</li><li>Select client or create new</li><li>Define service scope</li><li>Set frequency (weekly, monthly, etc.)</li><li>Pricing is calculated automatically with frequency discount</li></ol><h3>Contract Types</h3><ul><li><strong>Residential:</strong> Home window cleaning</li><li><strong>Commercial:</strong> Business properties</li><li><strong>Strata:</strong> Body corporate/apartment buildings</li></ul><h3>Automation</h3><p>Contracts automatically:</p><ul><li>Generate service tasks</li><li>Create invoices on completion</li><li>Send renewal reminders</li><li>Track MRR and ARR</li></ul>'
			},
			'analytics': {
				title: 'Analytics Dashboard',
				content: '<h2>Understanding Your Analytics</h2><h3>Key Metrics</h3><ul><li><strong>Total Revenue:</strong> All invoiced amounts</li><li><strong>Win Rate:</strong> Percentage of quotes converted</li><li><strong>Average Quote Value:</strong> Mean quote amount</li><li><strong>MRR/ARR:</strong> Monthly/Annual Recurring Revenue from contracts</li></ul><h3>Charts</h3><ul><li><strong>Revenue Trend:</strong> Track growth over time</li><li><strong>Service Mix:</strong> Windows vs Pressure breakdown</li><li><strong>Conversion Funnel:</strong> Quote ‚Üí Invoice ‚Üí Payment</li><li><strong>Client Sources:</strong> Where clients come from</li></ul><h3>Using Analytics</h3><p>Use analytics to:</p><ul><li>Identify your most profitable services</li><li>Track seasonal trends</li><li>Optimize pricing strategy</li><li>Focus marketing efforts</li></ul>'
			},
			'shortcuts': {
				title: 'Keyboard Shortcuts',
				content: '<h2>Keyboard Shortcuts</h2><h3>Navigation</h3><ul><li><kbd>?</kbd> - Show shortcuts help</li><li><kbd>Esc</kbd> - Close modals/dialogs</li><li><kbd>Ctrl/Cmd + S</kbd> - Save quote</li><li><kbd>Ctrl/Cmd + P</kbd> - Print/Generate PDF</li></ul><h3>Quote Creation</h3><ul><li><kbd>Ctrl/Cmd + W</kbd> - Add window line</li><li><kbd>Ctrl/Cmd + R</kbd> - Add pressure line</li><li><kbd>Ctrl/Cmd + N</kbd> - New quote</li></ul><h3>Pro Tip</h3><p>Press <kbd>?</kbd> anytime to see available shortcuts!</p>'
			},
			'offline': {
				title: 'Working Offline',
				content: '<h2>Offline Mode</h2><p>TicTacStick is designed to work completely offline - perfect for job sites without internet!</p><h3>What Works Offline</h3><ul><li>‚úÖ Creating quotes</li><li>‚úÖ Managing clients</li><li>‚úÖ Creating invoices</li><li>‚úÖ Taking photos</li><li>‚úÖ Recording payments</li><li>‚úÖ Viewing analytics</li></ul><h3>Data Sync</h3><p>When you reconnect to the internet:</p><ul><li>All changes are automatically saved</li><li>CRM data syncs with GoHighLevel</li><li>Email notifications are sent</li></ul><h3>Backup Your Data</h3><p>Regular backups are recommended:</p><ol><li>Go to Settings ‚Üí Backup</li><li>Click "Export All Data"</li><li>Save the JSON file safely</li></ol>'
			},
			'troubleshooting': {
				title: 'Troubleshooting',
				content: '<h2>Common Issues & Solutions</h2><h3>App Won\'t Load</h3><ul><li>Clear browser cache</li><li>Check if JavaScript is enabled</li><li>Try a different browser</li><li>Check console for errors (F12)</li></ul><h3>Data Not Saving</h3><ul><li>Check LocalStorage quota (Settings ‚Üí Storage)</li><li>Export old quotes to free space</li><li>Check browser privacy settings</li></ul><h3>PDF Generation Fails</h3><ul><li>Ensure pop-ups are allowed</li><li>Check internet connection (for jsPDF library)</li><li>Try Chrome or Firefox</li></ul><h3>Slow Performance</h3><ul><li>Clear old quotes and invoices</li><li>Reduce number of saved photos</li><li>Close other browser tabs</li><li>Restart browser</li></ul><h3>Still Need Help?</h3><p>Contact support:</p><ul><li>üìß support@925pressureglass.com.au</li><li>üìû 0400 000 000</li></ul>'
			}
		};

		// Search help content
		function searchHelp() {
			var query = document.getElementById('help-search').value.toLowerCase();
			if (!query) {
				// Show default content
				showHelpTopic('default');
				return;
			}

			// Simple search implementation
			var results = [];
			for (var topicId in HELP_TOPICS) {
				var topic = HELP_TOPICS[topicId];
				if (topic.title.toLowerCase().indexOf(query) !== -1 ||
				    topic.content.toLowerCase().indexOf(query) !== -1) {
					results.push(topic);
				}
			}

			var contentEl = document.getElementById('help-content');
			if (results.length === 0) {
				contentEl.innerHTML = '<h2>No Results Found</h2><p>No help topics found matching "' + query + '". Try different keywords or browse the topics above.</p>';
			} else {
				var html = '<h2>Search Results for "' + query + '"</h2>';
				for (var i = 0; i < results.length; i++) {
					html += '<div style="margin-bottom: 1.5rem; padding: 1rem; border-left: 3px solid #2563eb; background: #f9fafb;">';
					html += results[i].content;
					html += '</div>';
				}
				contentEl.innerHTML = html;
			}
		}

		// Show specific help topic
		function showHelpTopic(topic) {
			var contentEl = document.getElementById('help-content');
			if (!contentEl) return;

			if (topic === 'default' || !HELP_TOPICS[topic]) {
				// Show default welcome content
				contentEl.innerHTML = '<h2>Welcome to TicTacStick Help</h2><p>Select a topic from the quick links above or use the search bar to find what you\'re looking for.</p><h3>Popular Topics</h3><ul><li><a href="#" onclick="showHelpTopic(\'getting-started\'); return false;">Getting Started with TicTacStick</a></li><li><a href="#" onclick="showHelpTopic(\'quotes\'); return false;">How to Create a Quote</a></li><li><a href="#" onclick="showHelpTopic(\'invoices\'); return false;">Converting Quotes to Invoices</a></li><li><a href="#" onclick="showHelpTopic(\'contracts\'); return false;">Managing Recurring Contracts</a></li><li><a href="#" onclick="showHelpTopic(\'offline\'); return false;">Working Offline</a></li><li><a href="#" onclick="showHelpTopic(\'troubleshooting\'); return false;">Troubleshooting Common Issues</a></li></ul><h3>Need More Help?</h3><p>Contact support at support@925pressureglass.com.au or call 0400 000 000.</p>';
				return;
			}

			var helpTopic = HELP_TOPICS[topic];
			contentEl.innerHTML = helpTopic.content;

			// Scroll to top
			contentEl.scrollTop = 0;
		}

		// Initialize help system with custom functions
		if (window.HelpSystem) {
			window.HelpSystem.search = searchHelp;
			window.HelpSystem.showTopic = showHelpTopic;
		}
	</script>

	<!-- Settings Page Helper Functions & Backup/Restore Controller -->
	<script>
		// Export all data using BackupManager
		function exportAllData() {
			try {
				if (window.BackupManager && window.BackupManager.downloadBackup) {
					// Use downloadBackup() which handles everything correctly
					window.BackupManager.downloadBackup();

					// Update last backup date
					localStorage.setItem('tts_last_backup_timestamp', Date.now());
					updateLastBackupDate();

					if (window.UIComponents && window.UIComponents.showToast) {
						window.UIComponents.showToast('Backup exported successfully!', 'success');
					} else {
						alert('Backup exported successfully!');
					}
				} else {
					console.warn('[SETTINGS] BackupManager not available');
					alert('Backup system not loaded yet. Please try again in a moment.');
				}
			} catch (e) {
				console.error('[SETTINGS] Export failed:', e);
				if (window.UIComponents && window.UIComponents.showToast) {
					window.UIComponents.showToast('Export failed: ' + e.message, 'error');
				} else {
					alert('Export failed: ' + e.message);
				}
			}
		}

		// Import backup file
		function importBackupFile(event) {
			var file = event.target.files[0];
			if (!file) return;

			// Confirm action
			if (!confirm('‚ö†Ô∏è WARNING: Restoring a backup will REPLACE ALL current data!\n\nMake sure you have exported a backup of your current data first.\n\nContinue with restore?')) {
				event.target.value = '';
				return;
			}

			var reader = new FileReader();
			reader.onload = function(e) {
				try {
					var data = JSON.parse(e.target.result);

					if (window.BackupManager && window.BackupManager.importBackup) {
						// importBackup handles toast notifications and page reload internally
						window.BackupManager.importBackup(JSON.stringify(data));
					} else {
						console.warn('[SETTINGS] BackupManager not available');
						alert('Backup system not loaded yet. Please try again in a moment.');
					}
				} catch (error) {
					console.error('[SETTINGS] Import failed:', error);
					if (window.UIComponents && window.UIComponents.showToast) {
						window.UIComponents.showToast('Import failed: ' + error.message, 'error');
					} else {
						alert('Import failed: ' + error.message);
					}
				}
				event.target.value = '';
			};
			reader.readAsText(file);
		}

		// Toggle auto-backup
		function toggleAutoBackup() {
			var enabled = document.getElementById('auto-backup-enabled').checked;
			localStorage.setItem('tts_auto_backup_enabled', enabled ? 'true' : 'false');

			if (enabled) {
				if (window.BackupManager && window.BackupManager.scheduleAutoBackup) {
					window.BackupManager.scheduleAutoBackup();
				}
				if (window.UIComponents && window.UIComponents.showToast) {
					window.UIComponents.showToast('Auto-backup enabled', 'success');
				}
			} else {
				if (window.UIComponents && window.UIComponents.showToast) {
					window.UIComponents.showToast('Auto-backup disabled', 'info');
				}
			}
		}

		// Update last backup date display
		function updateLastBackupDate() {
			var timestamp = localStorage.getItem('tts_last_backup_timestamp');
			var el = document.getElementById('last-backup-date');
			if (el) {
				if (timestamp) {
					var date = new Date(parseInt(timestamp));
					el.textContent = date.toLocaleString();
				} else {
					el.textContent = 'Never';
				}
			}
		}

		// Refresh storage information
		function refreshStorageInfo() {
			try {
				var used = 0;
				var quota = 5 * 1024 * 1024; // 5 MB estimate

				// Calculate storage used
				for (var key in localStorage) {
					if (localStorage.hasOwnProperty(key)) {
						used += localStorage[key].length + key.length;
					}
				}

				var usedMB = (used / (1024 * 1024)).toFixed(2);
				var quotaMB = (quota / (1024 * 1024)).toFixed(0);
				var percentage = ((used / quota) * 100).toFixed(1);

				document.getElementById('storage-used').textContent = usedMB + ' MB';
				document.getElementById('storage-quota').textContent = quotaMB + ' MB';
				document.getElementById('storage-percentage').textContent = percentage + '%';

				// Update app info
				var ua = navigator.userAgent;
				var browserInfo = 'Unknown';
				if (ua.indexOf('Chrome') > -1) browserInfo = 'Chrome';
				else if (ua.indexOf('Safari') > -1) browserInfo = 'Safari';
				else if (ua.indexOf('Firefox') > -1) browserInfo = 'Firefox';
				else if (ua.indexOf('Edge') > -1) browserInfo = 'Edge';

				document.getElementById('browser-info').textContent = browserInfo;
				document.getElementById('offline-status').textContent = navigator.onLine ? 'üü¢ Online' : 'üî¥ Offline';

				// Check service worker
				if ('serviceWorker' in navigator) {
					navigator.serviceWorker.getRegistration().then(function(reg) {
						document.getElementById('sw-status').textContent = reg ? 'üü¢ Active' : 'üî¥ Not Registered';
					});
				} else {
					document.getElementById('sw-status').textContent = '‚ùå Not Supported';
				}

			} catch (e) {
				console.error('[SETTINGS] Storage info failed:', e);
			}
		}

		// Clear old quotes (90+ days)
		function clearOldQuotes() {
			if (!confirm('This will delete all quotes older than 90 days. Continue?')) return;

			try {
				var history = JSON.parse(localStorage.getItem('quote-history') || '[]');
				var now = Date.now();
				var threshold = 90 * 24 * 60 * 60 * 1000; // 90 days in ms
				var filtered = history.filter(function(quote) {
					return (now - new Date(quote.timestamp).getTime()) < threshold;
				});

				var deleted = history.length - filtered.length;
				localStorage.setItem('quote-history', JSON.stringify(filtered));

				if (window.UIComponents && window.UIComponents.showToast) {
					window.UIComponents.showToast('Deleted ' + deleted + ' old quotes', 'success');
				} else {
					alert('Deleted ' + deleted + ' old quotes');
				}
				refreshStorageInfo();
			} catch (e) {
				console.error('[SETTINGS] Clear old quotes failed:', e);
				alert('Failed to clear old quotes: ' + e.message);
			}
		}

		// Compress photos
		function compressPhotos() {
			if (!confirm('This will compress all photos to reduce storage usage. Continue?')) return;

			if (window.UIComponents && window.UIComponents.showToast) {
				window.UIComponents.showToast('Photo compression coming soon...', 'info');
			} else {
				alert('Photo compression feature coming soon!');
			}
		}

		// Confirm clear all data
		function confirmClearAllData() {
			if (!confirm('‚ö†Ô∏è DANGER: This will DELETE ALL DATA including quotes, clients, invoices, contracts, and settings!\n\nThis action CANNOT be undone!\n\nType "DELETE ALL" to confirm.')) return;

			var confirmation = prompt('Type "DELETE ALL" to confirm:');
			if (confirmation === 'DELETE ALL') {
				localStorage.clear();
				if (window.UIComponents && window.UIComponents.showToast) {
					window.UIComponents.showToast('All data cleared. Reloading...', 'success');
				}
				setTimeout(function() {
					location.reload();
				}, 1500);
			} else {
				if (window.UIComponents && window.UIComponents.showToast) {
					window.UIComponents.showToast('Cancelled', 'info');
				}
			}
		}

		// Initialize settings page
		function initSettingsPage() {
			updateLastBackupDate();
			refreshStorageInfo();

			// Set auto-backup checkbox
			var autoBackupEnabled = localStorage.getItem('tts_auto_backup_enabled') === 'true';
			var checkbox = document.getElementById('auto-backup-enabled');
			if (checkbox) {
				checkbox.checked = autoBackupEnabled;
			}
		}

		// Initialize when navigating to settings
		document.addEventListener('DOMContentLoaded', function() {
			// Add listener to init settings when page is shown
			var originalNavigateTo = window.navigateTo;
			if (originalNavigateTo) {
				window.navigateTo = function(page, params) {
					originalNavigateTo(page, params);
					if (page === 'settings') {
						setTimeout(initSettingsPage, 100);
					}
				};
			}
		});
	</script>

	<!-- Global Navigation System -->
	<script>
		/**
		 * Global navigation function for page switching
		 * @param {string} page - Page identifier (jobs, contracts, analytics-dashboard, help, tasks, customers, invoices, home, active-job, etc.)
		 * @param {Object} params - Optional navigation parameters
		 */
		function navigateTo(page, params) {
			console.log('[NAV] Navigate to:', page, params || {});

			// Get all page elements
			var mainApp = document.querySelector('.app');
			var allPages = document.querySelectorAll('.page');

			// Hide all pages first
			for (var i = 0; i < allPages.length; i++) {
				allPages[i].style.display = 'none';
			}

			// Show/hide main app based on page
			if (page === 'home' || !page) {
				// Show main quote app
				if (mainApp) {
					mainApp.style.display = 'block';
				}
				return;
			}

			// Hide main app for other pages
			if (mainApp) {
				mainApp.style.display = 'none';
			}

			// Show requested page
			var pageId = 'page-' + page;
			var targetPage = document.getElementById(pageId);

			if (targetPage) {
				targetPage.style.display = 'block';

				// Initialize page if needed
				if (page === 'tasks' && window.TaskDashboardUI && window.TaskDashboardUI.render) {
					window.TaskDashboardUI.render();
				} else if (page === 'contracts' && window.ContractManager && window.ContractManager.renderContractsList) {
					window.ContractManager.renderContractsList();
				} else if (page === 'analytics-dashboard' && window.AnalyticsDashboard && window.AnalyticsDashboard.updateDashboard) {
					window.AnalyticsDashboard.updateDashboard();
				} else if (page === 'help' && window.HelpSystem && window.HelpSystem.refresh) {
					window.HelpSystem.refresh();
				} else if (page === 'settings' && window.initSettingsPage) {
					window.initSettingsPage();
				} else if (page === 'jobs' && window.JobTrackingUI && window.JobTrackingUI.initJobsPage) {
					window.JobTrackingUI.initJobsPage();
				} else if (page === 'active-job' && params && params.jobId) {
					if (window.JobTrackingUI && window.JobTrackingUI.openJob) {
						window.JobTrackingUI.openJob(params.jobId);
					}
				} else if (page === 'invoices' && window.InvoiceSystem && window.InvoiceSystem.showInvoiceList) {
					window.InvoiceSystem.showInvoiceList();
				}

				console.log('[NAV] Navigated to:', page);
			} else {
				console.warn('[NAV] Page not found:', pageId);
				// Fallback to home
				if (mainApp) {
					mainApp.style.display = 'block';
				}
			}
		}

		// Go back to home/quote app
		function backToQuotes() {
			navigateTo('home');
		}

		// Export to window
		window.navigateTo = navigateTo;
		window.backToQuotes = backToQuotes;
	</script>

	<!-- Force window load event in automation to unblock Playwright -->
	<script>
		(function() {
			if (!window.APP_TEST_MODE) {
				return;
			}
			var loadDispatched = false;
			function markLoaded() {
				if (loadDispatched) {
					return;
				}
				loadDispatched = true;
			}
			function triggerLoad() {
				if (loadDispatched) {
					return;
				}
				loadDispatched = true;
				window.dispatchEvent(new Event('load'));
			}
			window.addEventListener('load', markLoaded);

			if (document.readyState === 'complete' || document.readyState === 'interactive') {
				setTimeout(triggerLoad, 50);
			} else {
				document.addEventListener('DOMContentLoaded', function() {
					setTimeout(triggerLoad, 50);
				});
			}
		})();
	</script>

	<!-- Service Worker Registration -->
	<script>
		// Register service worker for PWA offline support
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', function() {
				navigator.serviceWorker.register('/sw.js')
					.then(function(registration) {
						console.log('ServiceWorker registered: ', registration.scope);
					})
					.catch(function(error) {
						console.log('ServiceWorker registration failed: ', error);
					});
			});
		}
	</script>
</body>

</html>
